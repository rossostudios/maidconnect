"use strict";(self.webpackChunkcasaora=self.webpackChunkcasaora||[]).push([[4625],{"./node_modules/next-intl/dist/esm/production/react-client/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c3:()=>e});var use_intl__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/use-intl/dist/esm/production/react.js");function o(r,t){return(...r)=>{try{return t(...r)}catch{throw new Error(void 0)}}}const e=o(0,use_intl__WEBPACK_IMPORTED_MODULE_0__.c3);o(0,use_intl__WEBPACK_IMPORTED_MODULE_0__.kc)},"./src/components/bookings/pro-booking-list.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>pro_booking_list_stories});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),navigation=__webpack_require__("./node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.js"),react_client=__webpack_require__("./node_modules/next-intl/dist/esm/production/react-client/index.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),service_execution_card=__webpack_require__("./src/components/bookings/service-execution-card.tsx");function formatScheduled(scheduledStart){return scheduledStart?new Date(scheduledStart).toLocaleString("es-CO",{dateStyle:"medium",timeStyle:"short"}):"—"}function formatAmount(amount){return amount?new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}).format(amount):"—"}function getActionVisibility(status){return{showAcceptDecline:"authorized"===status,showCapture:"confirmed"===status,showVoid:"confirmed"===status}}function AcceptDeclineActions({booking,loadingId,onAction,t,size="default"}){const isMobile="mobile"===size,baseClass=isMobile?"inline-flex items-center justify-center rounded-xl px-4 py-3 font-semibold text-sm":"inline-flex items-center rounded-md px-3 py-1.5 font-semibold text-xs";return(0,jsx_runtime.jsxs)("div",{className:isMobile?"grid grid-cols-2 gap-3":"flex flex-wrap items-center gap-2",children:[(0,jsx_runtime.jsx)("button",{className:`${baseClass} bg-[#64748b] text-[#f8fafc] shadow-sm transition hover:bg-[#64748b] disabled:cursor-not-allowed disabled:opacity-70`,disabled:null!==loadingId,onClick:()=>onAction(booking,"accept"),type:"button",children:loadingId===`${booking.id}-accept`?t("actions.accepting"):t("actions.accept")}),(0,jsx_runtime.jsx)("button",{className:`${baseClass} ${isMobile?"border-2":"border"} border-[#64748b]/50 bg-[#f8fafc] text-[#64748b] transition hover:bg-[#64748b]/10 disabled:cursor-not-allowed disabled:opacity-70`,disabled:null!==loadingId,onClick:()=>onAction(booking,"decline"),type:"button",children:loadingId===`${booking.id}-decline`?t("actions.declining"):t("actions.decline")})]})}function CaptureVoidActions({booking,loadingId,onAction,t,showCapture,showVoid,size="default"}){const isMobile="mobile"===size,baseClass=isMobile?"inline-flex items-center justify-center rounded-xl px-4 py-3 font-semibold text-sm":"inline-flex items-center rounded-md px-3 py-1.5 font-semibold text-xs";return(0,jsx_runtime.jsxs)("div",{className:isMobile?"flex flex-col gap-3":"flex flex-wrap items-center gap-2",children:[showCapture&&(0,jsx_runtime.jsx)("button",{className:`${baseClass} bg-[#64748b] text-[#f8fafc] shadow-sm transition hover:bg-[#64748b] disabled:cursor-not-allowed disabled:opacity-70`,disabled:null!==loadingId,onClick:()=>onAction(booking,"capture"),type:"button",children:loadingId===`${booking.id}-capture`?t("actions.capturing"):t("actions.capture")}),showVoid&&(0,jsx_runtime.jsx)("button",{className:`${baseClass} ${isMobile?"border-2":"border"} border-[#e2e8f0] bg-[#f8fafc] text-[#94a3b8] transition hover:border-[#64748b] hover:text-[#64748b] disabled:cursor-not-allowed disabled:opacity-70`,disabled:null!==loadingId,onClick:()=>onAction(booking,"void"),type:"button",children:loadingId===`${booking.id}-void`?t("actions.canceling"):t("actions.cancelHold")})]})}function BookingTableRow({booking,loadingId,onAction,t}){const scheduled=formatScheduled(booking.scheduled_start),amountDisplay=formatAmount(booking.amount_authorized),{showAcceptDecline,showCapture,showVoid}=getActionVisibility(booking.status);return(0,jsx_runtime.jsxs)("tr",{className:"text-[#0f172a]",children:[(0,jsx_runtime.jsx)("td",{className:"px-4 py-3 font-medium",children:booking.id.slice(0,8)}),(0,jsx_runtime.jsx)("td",{className:"px-4 py-3 text-[#94a3b8]",children:booking.service_name||"—"}),(0,jsx_runtime.jsx)("td",{className:"px-4 py-3 text-[#94a3b8]",children:scheduled}),(0,jsx_runtime.jsx)("td",{className:"px-4 py-3 text-[#94a3b8]",children:amountDisplay}),(0,jsx_runtime.jsx)("td",{className:"px-4 py-3",children:(0,jsx_runtime.jsx)("span",{className:"inline-flex items-center rounded-full px-3 py-1 font-semibold text-xs "+(booking.status,"bg-[#64748b]/10 text-[#64748b]"),children:booking.status.replace(/_/g," ")})}),(0,jsx_runtime.jsx)("td",{className:"px-4 py-3",children:showAcceptDecline?(0,jsx_runtime.jsx)(AcceptDeclineActions,{booking,loadingId,onAction,t}):showCapture||showVoid?(0,jsx_runtime.jsx)(CaptureVoidActions,{booking,loadingId,onAction,showCapture,showVoid,t}):(0,jsx_runtime.jsx)("span",{className:"text-[#94a3b8] text-xs",children:t("actions.noActions")})})]},booking.id)}function BookingMobileCard({booking,loadingId,onAction,t}){const scheduled=formatScheduled(booking.scheduled_start),amountDisplay=formatAmount(booking.amount_authorized),{showAcceptDecline,showCapture,showVoid}=getActionVisibility(booking.status);return(0,jsx_runtime.jsxs)("div",{className:"rounded-2xl border border-[#e2e8f0] bg-[#f8fafc] p-5 shadow-sm",children:[(0,jsx_runtime.jsxs)("div",{className:"mb-4 flex items-start justify-between gap-3",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("p",{className:"text-[#94a3b8] text-xs uppercase tracking-wide",children:t("table.booking")}),(0,jsx_runtime.jsx)("p",{className:"mt-1 font-semibold text-base text-[#0f172a]",children:booking.id.slice(0,8)})]}),(0,jsx_runtime.jsx)("span",{className:"inline-flex items-center rounded-full px-3 py-1.5 font-semibold text-xs "+(booking.status,"bg-[#64748b]/10 text-[#64748b]"),children:booking.status.replace(/_/g," ")})]}),(0,jsx_runtime.jsxs)("div",{className:"space-y-3 border-[#e2e8f0] border-t pt-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between",children:[(0,jsx_runtime.jsx)("span",{className:"text-[#94a3b8] text-sm",children:t("table.service")}),(0,jsx_runtime.jsx)("span",{className:"font-medium text-[#0f172a] text-sm",children:booking.service_name||"—"})]}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between",children:[(0,jsx_runtime.jsx)("span",{className:"text-[#94a3b8] text-sm",children:t("table.scheduled")}),(0,jsx_runtime.jsx)("span",{className:"text-right font-medium text-[#0f172a] text-sm",children:scheduled})]}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between",children:[(0,jsx_runtime.jsx)("span",{className:"text-[#94a3b8] text-sm",children:t("table.amount")}),(0,jsx_runtime.jsx)("span",{className:"font-semibold text-base text-[#0f172a]",children:amountDisplay})]})]}),(showAcceptDecline||showCapture||showVoid)&&(0,jsx_runtime.jsxs)("div",{className:"mt-4 border-[#e2e8f0] border-t pt-4",children:[showAcceptDecline&&(0,jsx_runtime.jsx)(AcceptDeclineActions,{booking,loadingId,onAction,size:"mobile",t}),(showCapture||showVoid)&&(0,jsx_runtime.jsx)(CaptureVoidActions,{booking,loadingId,onAction,showCapture,showVoid,size:"mobile",t})]})]},booking.id)}function ProBookingList({bookings}){const router=(0,navigation.useRouter)(),t=(0,react_client.c3)("dashboard.pro.bookingList"),[loadingId,setLoadingId]=(0,react.useState)(null),[message,setMessage]=(0,react.useState)(null),[optimisticBookings,updateOptimisticBooking]=(0,react.useOptimistic)(bookings,(state,{id,status})=>state.map(booking=>booking.id===id?{...booking,status}:booking)),handleAction=async(booking,action)=>"accept"===action||"decline"===action?async function handleAcceptDecline(booking,action,setLoadingId,setMessage,updateOptimisticBooking,router,t){setLoadingId(`${booking.id}-${action}`),setMessage(null);const newStatus="accept"===action?"confirmed":"declined";updateOptimisticBooking({id:booking.id,status:newStatus});try{const endpoint="accept"===action?"/api/bookings/accept":"/api/bookings/decline",response=await fetch(endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bookingId:booking.id})});if(!response.ok){const body=await response.json().catch(()=>({}));throw new Error(body.error??`Failed to ${action} booking`)}setMessage(t("success",{action:t("accept"===action?"actions.accept":"actions.decline")})),router.refresh()}catch(error){setMessage(error instanceof Error?error.message:`Unexpected error ${action}ing booking`)}finally{setLoadingId(null)}}(booking,action,setLoadingId,setMessage,updateOptimisticBooking,router,t):async function handleCaptureVoid(booking,action,setLoadingId,setMessage,router){if(booking.stripe_payment_intent_id){setLoadingId(`${booking.id}-${action}`),setMessage(null);try{const endpoint="capture"===action?"/api/payments/capture-intent":"/api/payments/void-intent",response=await fetch(endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentIntentId:booking.stripe_payment_intent_id,amountToCapture:booking.amount_authorized??void 0})});if(!response.ok){const body=await response.json().catch(()=>({}));throw new Error(body.error??"Stripe action failed")}router.refresh()}catch(error){setMessage(error instanceof Error?error.message:"Unexpected error running payment action")}finally{setLoadingId(null)}}else setMessage("Missing payment intent for this booking.")}(booking,action,setLoadingId,setMessage,router);if(0===optimisticBookings.length)return(0,jsx_runtime.jsx)("p",{className:"text-[#94a3b8] text-sm",children:t("emptyState")});const activeServiceBookings=optimisticBookings.filter(b=>"confirmed"===b.status||"in_progress"===b.status),otherBookings=optimisticBookings.filter(b=>"confirmed"!==b.status&&"in_progress"!==b.status);return(0,jsx_runtime.jsxs)("div",{className:"space-y-6",children:[message?(0,jsx_runtime.jsx)("p",{className:"text-sm "+(message.includes("successfully"),"text-[#64748b]"),children:message}):null,activeServiceBookings.length>0&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"mb-4 font-semibold text-[#94a3b8] text-sm uppercase tracking-wide",children:t("sections.activeServices")}),(0,jsx_runtime.jsx)("div",{className:"space-y-4",children:activeServiceBookings.map(booking=>(0,jsx_runtime.jsx)(service_execution_card.W,{booking},booking.id))})]}),otherBookings.length>0&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"mb-4 font-semibold text-[#94a3b8] text-sm uppercase tracking-wide",children:activeServiceBookings.length>0?t("sections.otherBookings"):t("sections.allBookings")}),(0,jsx_runtime.jsx)("div",{className:"hidden overflow-hidden rounded-2xl border border-[#e2e8f0] md:block",children:(0,jsx_runtime.jsxs)("table",{className:"min-w-full divide-y divide-[#e2e8f0] text-sm",children:[(0,jsx_runtime.jsx)("thead",{className:"bg-[#f8fafc] text-[#94a3b8] text-xs uppercase tracking-wide",children:(0,jsx_runtime.jsxs)("tr",{children:[(0,jsx_runtime.jsx)("th",{className:"px-4 py-3 text-left",children:t("table.booking")}),(0,jsx_runtime.jsx)("th",{className:"px-4 py-3 text-left",children:t("table.service")}),(0,jsx_runtime.jsx)("th",{className:"px-4 py-3 text-left",children:t("table.scheduled")}),(0,jsx_runtime.jsx)("th",{className:"px-4 py-3 text-left",children:t("table.amount")}),(0,jsx_runtime.jsx)("th",{className:"px-4 py-3 text-left",children:t("table.status")}),(0,jsx_runtime.jsx)("th",{className:"px-4 py-3 text-left",children:t("table.actions")})]})}),(0,jsx_runtime.jsx)("tbody",{className:"divide-y divide-[#f8fafc] bg-[#f8fafc]",children:otherBookings.map(booking=>(0,jsx_runtime.jsx)(BookingTableRow,{booking,loadingId,onAction:handleAction,t},booking.id))})]})}),(0,jsx_runtime.jsx)("div",{className:"space-y-4 md:hidden",children:otherBookings.map(booking=>(0,jsx_runtime.jsx)(BookingMobileCard,{booking,loadingId,onAction:handleAction,t},booking.id))})]})]})}try{ProBookingList.displayName="ProBookingList",ProBookingList.__docgenInfo={description:"",displayName:"ProBookingList",props:{bookings:{defaultValue:null,description:"",name:"bookings",required:!0,type:{name:"ProfessionalBooking[]"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/bookings/pro-booking-list.tsx#ProBookingList"]={docgenInfo:ProBookingList.__docgenInfo,name:"ProBookingList",path:"src/components/bookings/pro-booking-list.tsx#ProBookingList"})}catch(__react_docgen_typescript_loader_error){}const pro_booking_list_stories={title:"Bookings/ProBookingList",component:ProBookingList,parameters:{layout:"padded"},tags:["autodocs"]},Default={},__namedExportsOrder=["Default"]}}]);
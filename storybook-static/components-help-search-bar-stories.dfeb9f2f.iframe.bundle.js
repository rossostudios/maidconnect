"use strict";(self.webpackChunkcasaora=self.webpackChunkcasaora||[]).push([[24081,52136,95746],{"./node_modules/@hugeicons/react/dist/esm/HugeiconsIcon.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{n:()=>HugeiconsIcon});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");const defaultAttributes={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none"},HugeiconsIcon=(0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({color="currentColor",size=24,strokeWidth,absoluteStrokeWidth=!1,className="",altIcon,showAlt=!1,icon,primaryColor,secondaryColor,disableSecondaryOpacity=!1,...rest},ref)=>{const calculatedStrokeWidth=void 0!==strokeWidth?absoluteStrokeWidth?24*Number(strokeWidth)/Number(size):strokeWidth:void 0,strokeProps=void 0!==calculatedStrokeWidth?{strokeWidth:calculatedStrokeWidth,stroke:"currentColor"}:{},elementProps={ref,...defaultAttributes,width:size,height:size,color:primaryColor||color,className,...strokeProps,...rest},svgChildren=[...showAlt&&altIcon?altIcon:icon].sort(([,a],[,b])=>{const hasOpacityA=void 0!==a.opacity;return void 0!==b.opacity?1:hasOpacityA?-1:0}).map(([tag,attrs])=>{const isSecondaryPath=void 0!==attrs.opacity,pathOpacity=isSecondaryPath&&!disableSecondaryOpacity?attrs.opacity:void 0,fillProps=secondaryColor?{...void 0!==attrs.stroke?{stroke:isSecondaryPath?secondaryColor:primaryColor||color}:{fill:isSecondaryPath?secondaryColor:primaryColor||color}}:{};return(0,react__WEBPACK_IMPORTED_MODULE_0__.createElement)(tag,{...attrs,...strokeProps,...fillProps,opacity:pathOpacity,key:attrs.key})});return(0,react__WEBPACK_IMPORTED_MODULE_0__.createElement)("svg",elementProps,svgChildren)});HugeiconsIcon.displayName="HugeiconsIcon"},"./node_modules/next-intl/dist/esm/production/react-client/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c3:()=>e});var use_intl__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/use-intl/dist/esm/production/react.js");function o(r,t){return(...r)=>{try{return t(...r)}catch{throw new Error(void 0)}}}const e=o(0,use_intl__WEBPACK_IMPORTED_MODULE_0__.c3);o(0,use_intl__WEBPACK_IMPORTED_MODULE_0__.kc)},"./src/components/help/search-bar.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>__WEBPACK_DEFAULT_EXPORT__});const __WEBPACK_DEFAULT_EXPORT__={title:"Help/SearchBar",component:__webpack_require__("./src/components/help/search-bar.tsx").SearchBar,parameters:{layout:"padded"},tags:["autodocs"]},Default={},__namedExportsOrder=["Default"]},"./src/components/help/search-bar.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{b:()=>HelpSearchBar});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),_hugeicons_core_free_icons__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@hugeicons/core-free-icons/dist/esm/index.min.js"),_hugeicons_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@hugeicons/react/dist/esm/HugeiconsIcon.js"),next_navigation__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.js"),next_intl__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/next-intl/dist/esm/production/react-client/index.js"),next_intl__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/use-intl/dist/esm/production/react.js"),react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),_hooks_use_debounce__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./src/hooks/use-debounce.ts"),_lib_supabase_browser_client__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./src/lib/supabase/browser-client.ts"),console=__webpack_require__("./node_modules/console-browserify/index.js");function HelpSearchBar({placeholder,autoFocus=!1,className="",onClose}){const t=(0,next_intl__WEBPACK_IMPORTED_MODULE_4__.c3)("help"),locale=(0,next_intl__WEBPACK_IMPORTED_MODULE_5__.Ym)(),router=(0,next_navigation__WEBPACK_IMPORTED_MODULE_3__.useRouter)(),[query,setQuery]=(0,react__WEBPACK_IMPORTED_MODULE_6__.useState)(""),[results,setResults]=(0,react__WEBPACK_IMPORTED_MODULE_6__.useState)([]),[isLoading,setIsLoading]=(0,react__WEBPACK_IMPORTED_MODULE_6__.useState)(!1),[showResults,setShowResults]=(0,react__WEBPACK_IMPORTED_MODULE_6__.useState)(!1),[selectedIndex,setSelectedIndex]=(0,react__WEBPACK_IMPORTED_MODULE_6__.useState)(-1),debouncedQuery=(0,_hooks_use_debounce__WEBPACK_IMPORTED_MODULE_7__.d)(query,300);(0,react__WEBPACK_IMPORTED_MODULE_6__.useEffect)(()=>{setSelectedIndex(-1)},[]);const highlightSearchTerm=(0,react__WEBPACK_IMPORTED_MODULE_6__.useCallback)((text,searchQuery)=>{if(!searchQuery.trim())return text;const escapedQuery=searchQuery.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),regex=new RegExp(`(${escapedQuery})`,"gi");return text.replace(regex,'<mark class="bg-[#64748b]/20 text-[#0f172a] font-medium">$1</mark>')},[]),trackSearch=(0,react__WEBPACK_IMPORTED_MODULE_6__.useCallback)(async(searchQuery,resultCount)=>{try{const supabase=(0,_lib_supabase_browser_client__WEBPACK_IMPORTED_MODULE_8__.createSupabaseBrowserClient)(),{data:{user}}=await supabase.auth.getUser();let sessionId=localStorage.getItem("help_session_id");sessionId||(sessionId=crypto.randomUUID(),localStorage.setItem("help_session_id",sessionId)),await supabase.from("help_search_analytics").insert({query:searchQuery.trim(),locale,result_count:resultCount,user_id:user?.id||null,session_id:user?null:sessionId})}catch(error){console.error("Analytics tracking failed:",error)}},[locale]),searchArticles=(0,react__WEBPACK_IMPORTED_MODULE_6__.useCallback)(async searchQuery=>{if(!searchQuery.trim()||searchQuery.length<2)setResults([]);else{setIsLoading(!0);try{const params=new URLSearchParams({q:searchQuery,locale,type:"help",limit:"8"}),response=await fetch(`/api/search?${params.toString()}`);if(!response.ok)throw new Error("Search request failed");const data=await response.json();if(data.success){const searchResults=(data.data||[]).map(result=>{const urlParts=result.url.split("/").filter(Boolean),categorySlug=result.metadata?.categorySlug||urlParts[2]||"",articleSlug=urlParts[3]||"";return{id:result.id,category_id:result.metadata?.category||"",category_slug:categorySlug,category_name:result.metadata?.category||"",slug:articleSlug,title:result.title,excerpt:result.description,rank:0}});setResults(searchResults),trackSearch(searchQuery,searchResults.length)}else console.error("Search error:",data.error),setResults([])}catch(error){console.error("Search failed:",error),setResults([])}finally{setIsLoading(!1)}}},[locale,trackSearch]);(0,react__WEBPACK_IMPORTED_MODULE_6__.useEffect)(()=>{searchArticles(debouncedQuery).catch(()=>{})},[debouncedQuery,searchArticles]);const handleResultClick=async result=>{try{const supabase=(0,_lib_supabase_browser_client__WEBPACK_IMPORTED_MODULE_8__.createSupabaseBrowserClient)(),{data:{user}}=await supabase.auth.getUser(),sessionId=localStorage.getItem("help_session_id");await supabase.from("help_search_analytics").update({clicked_article_id:result.id}).match({query:query.trim(),locale,...user?{user_id:user.id}:{session_id:sessionId}}).order("created_at",{ascending:!1}).limit(1)}catch(error){console.error("Click tracking failed:",error)}router.push(`/${locale}/help/${result.category_slug}/${result.slug}`),setQuery(""),setShowResults(!1),onClose?.()};return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:`relative w-full ${className}`,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"relative",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_hugeicons_react__WEBPACK_IMPORTED_MODULE_2__.n,{className:"h-5 w-5 text-[#94a3b8]/70",icon:_hugeicons_core_free_icons__WEBPACK_IMPORTED_MODULE_1__.Bbl})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("input",{autoFocus,className:"w-full rounded-lg border border-[#94a3b8]/40 bg-[#f8fafc] py-3 pr-10 pl-12 text-[#0f172a] placeholder-[#94a3b8] focus:border-[#64748b] focus:outline-none focus:ring-2 focus:ring-[#64748b]/20",onChange:e=>{setQuery(e.target.value),setShowResults(!0)},onFocus:()=>setShowResults(!0),onKeyDown:e=>{if(showResults&&0!==results.length)switch(e.key){case"ArrowDown":e.preventDefault(),setSelectedIndex(prev=>prev<results.length-1?prev+1:0);break;case"ArrowUp":e.preventDefault(),setSelectedIndex(prev=>prev>0?prev-1:results.length-1);break;case"Enter":e.preventDefault(),selectedIndex>=0&&results[selectedIndex]&&handleResultClick(results[selectedIndex])}},placeholder:placeholder||t("search.placeholder"),type:"search",value:query}),query&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{className:"absolute inset-y-0 right-0 flex items-center pr-4 text-[#94a3b8]/70 hover:text-[#94a3b8]",onClick:()=>{setQuery(""),setResults([]),setShowResults(!1),onClose?.()},type:"button",children:isLoading?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_hugeicons_react__WEBPACK_IMPORTED_MODULE_2__.n,{className:"h-5 w-5 animate-spin",icon:_hugeicons_core_free_icons__WEBPACK_IMPORTED_MODULE_1__.H5m}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_hugeicons_react__WEBPACK_IMPORTED_MODULE_2__.n,{className:"h-5 w-5",icon:_hugeicons_core_free_icons__WEBPACK_IMPORTED_MODULE_1__.bJi})})]}),showResults&&query.length>=2&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"absolute z-50 mt-2 w-full overflow-hidden rounded-lg border border-[#e2e8f0] bg-[#f8fafc] shadow-lg",children:isLoading&&0===results.length?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex items-center justify-center px-4 py-8",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_hugeicons_react__WEBPACK_IMPORTED_MODULE_2__.n,{className:"mr-2 h-5 w-5 animate-spin text-[#64748b]",icon:_hugeicons_core_free_icons__WEBPACK_IMPORTED_MODULE_1__.H5m}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"text-[#94a3b8] text-sm",children:t("search.searching")})]}):results.length>0?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"max-h-96 overflow-y-auto",children:[results.map((result,index)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("button",{className:"w-full border-[#e2e8f0]/40 border-b px-4 py-3 text-left transition last:border-b-0 "+(selectedIndex===index?"border-[#64748b] bg-[#64748b]/10":"hover:bg-[#f8fafc]"),onClick:()=>handleResultClick(result),type:"button",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"mb-1 flex items-center gap-2",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"rounded bg-[#e2e8f0]/30 px-2 py-0.5 text-[#94a3b8] text-xs",children:result.category_name})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"font-medium text-[#0f172a]",dangerouslySetInnerHTML:{__html:highlightSearchTerm(result.title,query)}}),result.excerpt&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:"mt-1 line-clamp-2 text-[#94a3b8] text-sm",dangerouslySetInnerHTML:{__html:highlightSearchTerm(result.excerpt,query)}})]},result.id)),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"border-[#e2e8f0]/40 border-t bg-[#f8fafc] px-4 py-2 text-center",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{className:"text-[#64748b] text-sm hover:underline",onClick:()=>{router.push(`/${locale}/help?q=${encodeURIComponent(query)}`),setShowResults(!1)},type:"button",children:t("search.viewAll")})})]}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"px-4 py-8 text-center",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:"text-[#94a3b8] text-sm",children:t("search.noResults")}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{className:"mt-2 text-[#64748b] text-sm hover:underline",onClick:()=>router.push(`/${locale}/help`),type:"button",children:t("search.browseAll")})]})}),showResults&&query.length>=2&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{className:"fixed inset-0 z-40",onClick:()=>setShowResults(!1),onKeyDown:e=>{"Escape"===e.key&&setShowResults(!1)},tabIndex:-1,type:"button",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"sr-only",children:"Close search results"})})]})}try{HelpSearchBar.displayName="HelpSearchBar",HelpSearchBar.__docgenInfo={description:"",displayName:"HelpSearchBar",props:{placeholder:{defaultValue:null,description:"",name:"placeholder",required:!1,type:{name:"string"}},autoFocus:{defaultValue:{value:"false"},description:"",name:"autoFocus",required:!1,type:{name:"boolean"}},className:{defaultValue:{value:""},description:"",name:"className",required:!1,type:{name:"string"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!1,type:{name:"() => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/help/search-bar.tsx#HelpSearchBar"]={docgenInfo:HelpSearchBar.__docgenInfo,name:"HelpSearchBar",path:"src/components/help/search-bar.tsx#HelpSearchBar"})}catch(__react_docgen_typescript_loader_error){}},"./src/hooks/use-debounce.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{d:()=>useDebounce});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");function useDebounce(value,delay=500){const[debouncedValue,setDebouncedValue]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(value);return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{const handler=setTimeout(()=>{setDebouncedValue(value)},delay);return()=>{clearTimeout(handler)}},[value,delay]),debouncedValue}},"./src/lib/supabase/browser-client.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{createSupabaseBrowserClient:()=>createSupabaseBrowserClient});var _supabase_ssr__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@supabase/ssr/dist/module/index.js");function createSupabaseBrowserClient(){const supabaseUrl="https://hvnetxfsrtplextvtwfx.supabase.co",supabaseKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh2bmV0eGZzcnRwbGV4dHZ0d2Z4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1ODc0NTEsImV4cCI6MjA3NzE2MzQ1MX0.7-N06om_ntUuGP1NZ0Zcqz01s975xJfiKno34aIW__o";return(0,_supabase_ssr__WEBPACK_IMPORTED_MODULE_0__.createBrowserClient)(supabaseUrl,supabaseKey)}}}]);
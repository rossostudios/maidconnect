"use strict";(self.webpackChunkcasaora=self.webpackChunkcasaora||[]).push([[46934],{"./src/components/bookings/cancel-booking-modal.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{CancelBookingModal:()=>CancelBookingModal});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react_client=__webpack_require__("./node_modules/next-intl/dist/esm/production/react-client/index.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),form_modal=__webpack_require__("./src/components/shared/form-modal.tsx"),use_api_mutation=__webpack_require__("./src/hooks/use-api-mutation.ts"),use_modal_form=__webpack_require__("./src/hooks/use-modal-form.ts");function CancelBookingModal({isOpen,onClose,booking}){const t=(0,react_client.c3)("dashboard.customer.cancelBookingModal"),[policy,setPolicy]=(0,react.useState)(null),form=(0,use_modal_form.F)({initialData:{reason:""},resetOnClose:!0}),cancelMutation=(0,use_api_mutation.L)({url:"/api/bookings/cancel",method:"POST",refreshOnSuccess:!0,onSuccess:result=>{form.setMessage(t("messages.success",{refund:result.refund.formatted_refund}),"success"),setTimeout(()=>{onClose()},2e3)},onError:error=>{form.setError(error.message||t("errors.failedToCancel"))}});(0,react.useEffect)(()=>{if(isOpen&&booking.scheduled_start){const calculatedPolicy=function calculateCancellationPolicy(scheduledStart,currentStatus){if("completed"===currentStatus)return{canCancel:!1,refundPercentage:0,reason:"Cannot cancel completed services",hoursUntilService:0};if("in_progress"===currentStatus)return{canCancel:!1,refundPercentage:0,reason:"Cannot cancel service that is already in progress",hoursUntilService:0};const scheduledTime=new Date(scheduledStart),now=new Date,hoursUntilService=(scheduledTime.getTime()-now.getTime())/1e3/60/60;return hoursUntilService<0?{canCancel:!1,refundPercentage:0,reason:"Cannot cancel past services",hoursUntilService}:hoursUntilService>=24?{canCancel:!0,refundPercentage:100,reason:"Full refund - canceling more than 24 hours in advance",hoursUntilService}:hoursUntilService>=12?{canCancel:!0,refundPercentage:50,reason:"50% refund - canceling 12-24 hours in advance",hoursUntilService}:hoursUntilService>=4?{canCancel:!0,refundPercentage:25,reason:"25% refund - canceling 4-12 hours in advance",hoursUntilService}:{canCancel:!0,refundPercentage:0,reason:"No refund - canceling less than 4 hours before service",hoursUntilService}}(booking.scheduled_start,booking.status);setPolicy(calculatedPolicy)}},[isOpen,booking.scheduled_start,booking.status]),(0,react.useEffect)(()=>{isOpen||(setPolicy(null),form.reset())},[isOpen,form.reset]);const refundAmount=booking.amount_authorized&&policy?booking.amount_authorized*policy.refundPercentage/100:0;return(0,jsx_runtime.jsxs)(form_modal.k,{cancelLabel:t("buttons.keepBooking"),customActions:(0,jsx_runtime.jsxs)("div",{className:"flex gap-3",children:[(0,jsx_runtime.jsx)("button",{className:"flex-1 rounded-full border-2 border-[#e2e8f0] bg-[#f8fafc] px-6 py-3 font-semibold text-base text-[#0f172a] transition hover:border-[#64748b] hover:text-[#64748b] disabled:cursor-not-allowed disabled:opacity-70",disabled:form.isSubmitting,onClick:onClose,type:"button",children:t("buttons.keepBooking")}),policy?.canCancel&&(0,jsx_runtime.jsx)("button",{className:"flex-1 rounded-full bg-[#64748b] px-6 py-3 font-semibold text-base text-[#f8fafc] transition hover:bg-[#64748b] disabled:cursor-not-allowed disabled:opacity-70",disabled:form.isSubmitting,onClick:async()=>{policy?.canCancel?await form.handleSubmit(async data=>await cancelMutation.mutate({bookingId:booking.id,reason:data.reason||void 0})):form.setError(t("errors.cannotCancel"))},type:"button",children:form.isSubmitting?t("buttons.canceling"):t("buttons.cancelBooking")})]}),isOpen,onClose,showActions:!1,size:"lg",title:t("title"),children:[(0,jsx_runtime.jsxs)("p",{className:"text-base text-[#94a3b8]",children:[booking.service_name||"Service"," •"," ",booking.scheduled_start?new Date(booking.scheduled_start).toLocaleString("es-CO",{dateStyle:"medium",timeStyle:"short"}):"—"]}),policy&&(0,jsx_runtime.jsxs)("div",{className:"mt-6 rounded-2xl border p-6 "+(policy.canCancel?"border-[#64748b]/30 bg-[#64748b]/5":"border-[#64748b]/30 bg-[#64748b]/10"),children:[(0,jsx_runtime.jsx)("p",{className:"font-semibold text-base "+(policy.canCancel,"text-[#64748b]"),children:policy.reason}),policy.canCancel&&(0,jsx_runtime.jsxs)("div",{className:"mt-3 space-y-1 text-base text-[#64748b]",children:[(0,jsx_runtime.jsxs)("p",{children:[(0,jsx_runtime.jsx)("strong",{children:"Refund:"})," ",policy.refundPercentage,"% (",(amount=refundAmount,currency=booking.currency,amount?new Intl.NumberFormat("es-CO",{style:"currency",currency:currency||"COP"}).format(amount/100):"—"),")"]}),(0,jsx_runtime.jsxs)("p",{children:[(0,jsx_runtime.jsx)("strong",{children:"Time until service:"})," ",Math.floor(policy.hoursUntilService)," hours"]})]})]}),(0,jsx_runtime.jsxs)("details",{className:"mt-6",children:[(0,jsx_runtime.jsx)("summary",{className:"cursor-pointer font-semibold text-base text-[#0f172a]",children:t("policy.viewPolicy")}),(0,jsx_runtime.jsx)("pre",{className:"mt-3 whitespace-pre-wrap text-[#94a3b8] text-sm leading-relaxed",children:"\nOur cancellation policy:\n• More than 24 hours before service: 100% refund\n• 12-24 hours before service: 50% refund\n• 4-12 hours before service: 25% refund\n• Less than 4 hours before service: No refund\n\nNote: Once the service has started, cancellation is not possible.\n  ".trim()})]}),policy?.canCancel&&(0,jsx_runtime.jsxs)("div",{className:"mt-6",children:[(0,jsx_runtime.jsx)("label",{className:"mb-2 block font-semibold text-base text-[#0f172a]",htmlFor:"reason",children:t("form.reasonLabel")}),(0,jsx_runtime.jsx)("textarea",{className:"w-full rounded-xl border border-[#e2e8f0] px-4 py-4 text-base shadow-sm focus:border-[#64748b] focus:outline-none focus:ring-2 focus:ring-[#64748b]/20",id:"reason",onChange:e=>form.updateField("reason",e.target.value),placeholder:t("form.reasonPlaceholder"),rows:4,value:form.formData.reason})]}),form.message&&(0,jsx_runtime.jsx)("div",{className:"mt-6 rounded-2xl p-4 text-base "+(form.success,"bg-[#64748b]/10 text-[#64748b]"),children:form.message})]});var amount,currency}try{CancelBookingModal.displayName="CancelBookingModal",CancelBookingModal.__docgenInfo={description:"",displayName:"CancelBookingModal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},booking:{defaultValue:null,description:"",name:"booking",required:!0,type:{name:"{ id: string; service_name: string; scheduled_start: string; status: string; amount_authorized: number; currency: string; }"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/bookings/cancel-booking-modal.tsx#CancelBookingModal"]={docgenInfo:CancelBookingModal.__docgenInfo,name:"CancelBookingModal",path:"src/components/bookings/cancel-booking-modal.tsx#CancelBookingModal"})}catch(__react_docgen_typescript_loader_error){}}}]);
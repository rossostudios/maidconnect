"use strict";(self.webpackChunkcasaora=self.webpackChunkcasaora||[]).push([[24081,97323],{"./node_modules/@hugeicons/react/dist/esm/HugeiconsIcon.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{n:()=>HugeiconsIcon});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");const defaultAttributes={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none"},HugeiconsIcon=(0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({color="currentColor",size=24,strokeWidth,absoluteStrokeWidth=!1,className="",altIcon,showAlt=!1,icon,primaryColor,secondaryColor,disableSecondaryOpacity=!1,...rest},ref)=>{const calculatedStrokeWidth=void 0!==strokeWidth?absoluteStrokeWidth?24*Number(strokeWidth)/Number(size):strokeWidth:void 0,strokeProps=void 0!==calculatedStrokeWidth?{strokeWidth:calculatedStrokeWidth,stroke:"currentColor"}:{},elementProps={ref,...defaultAttributes,width:size,height:size,color:primaryColor||color,className,...strokeProps,...rest},svgChildren=[...showAlt&&altIcon?altIcon:icon].sort(([,a],[,b])=>{const hasOpacityA=void 0!==a.opacity;return void 0!==b.opacity?1:hasOpacityA?-1:0}).map(([tag,attrs])=>{const isSecondaryPath=void 0!==attrs.opacity,pathOpacity=isSecondaryPath&&!disableSecondaryOpacity?attrs.opacity:void 0,fillProps=secondaryColor?{...void 0!==attrs.stroke?{stroke:isSecondaryPath?secondaryColor:primaryColor||color}:{fill:isSecondaryPath?secondaryColor:primaryColor||color}}:{};return(0,react__WEBPACK_IMPORTED_MODULE_0__.createElement)(tag,{...attrs,...strokeProps,...fillProps,opacity:pathOpacity,key:attrs.key})});return(0,react__WEBPACK_IMPORTED_MODULE_0__.createElement)("svg",elementProps,svgChildren)});HugeiconsIcon.displayName="HugeiconsIcon"},"./src/components/notifications/notification-permission-prompt.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>notification_permission_prompt_stories});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),index_min=__webpack_require__("./node_modules/@hugeicons/core-free-icons/dist/esm/index.min.js"),esm_HugeiconsIcon=__webpack_require__("./node_modules/@hugeicons/react/dist/esm/HugeiconsIcon.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),console=__webpack_require__("./node_modules/console-browserify/index.js");function usePushNotifications(){const[permission,setPermission]=(0,react.useState)("default"),[subscription,setSubscription]=(0,react.useState)(null),[isSupported,setIsSupported]=(0,react.useState)(!1),[isLoading,setIsLoading]=(0,react.useState)(!1),[error,setError]=(0,react.useState)(null);(0,react.useEffect)(()=>{const supported="serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window;setIsSupported(supported),supported&&"undefined"!=typeof Notification&&setPermission(Notification.permission)},[]);const registerServiceWorker=(0,react.useCallback)(async()=>{if(!isSupported)throw new Error("Push notifications not supported");return await navigator.serviceWorker.register("/sw.js",{scope:"/"})},[isSupported]),subscribe=(0,react.useCallback)(async()=>{if(!isSupported||"granted"!==permission)return null;setIsLoading(!0),setError(null);try{const registration=await registerServiceWorker();await navigator.serviceWorker.ready;const vapidPublicKey="your-vapid-public-key";if(!vapidPublicKey)throw new Error("VAPID public key not configured");const subscriptionJSON=(await registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:urlBase64ToUint8Array(vapidPublicKey)})).toJSON();if(!subscriptionJSON.endpoint||!subscriptionJSON.keys)throw new Error("Invalid subscription");const sub={endpoint:subscriptionJSON.endpoint,keys:{p256dh:subscriptionJSON.keys.p256dh||"",auth:subscriptionJSON.keys.auth||""}};return setSubscription(sub),await async function saveSubscription(subscription){const response=await fetch("/api/notifications/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({endpoint:subscription.endpoint,p256dh:subscription.keys.p256dh,auth:subscription.keys.auth,userAgent:navigator.userAgent})});if(!response.ok)throw new Error("Failed to save subscription")}(sub),sub}catch(err){const message=err instanceof Error?err.message:"Failed to subscribe";return setError(message),null}finally{setIsLoading(!1)}},[isSupported,permission,registerServiceWorker]),requestPermission=(0,react.useCallback)(async()=>{if(!isSupported)return setError("Push notifications are not supported in this browser"),!1;setIsLoading(!0),setError(null);try{const result=await Notification.requestPermission();return setPermission(result),"granted"===result?(await subscribe(),!0):"denied"===result&&(setError("Notification permission denied"),!1)}catch(err){const message=err instanceof Error?err.message:"Failed to request permission";return setError(message),!1}finally{setIsLoading(!1)}},[isSupported,subscribe]),unsubscribe=(0,react.useCallback)(async()=>{if(!isSupported)return!1;setIsLoading(!0),setError(null);try{const registration=await navigator.serviceWorker.ready,pushSubscription=await registration.pushManager.getSubscription();return!!pushSubscription&&(await pushSubscription.unsubscribe(),await async function deleteSubscription(){try{if(!(await fetch("/api/notifications/subscribe",{method:"DELETE"})).ok)throw new Error("Failed to delete subscription")}catch(err){console.warn("Failed to delete push subscription from server:",err)}}(),setSubscription(null),!0)}catch(err){const message=err instanceof Error?err.message:"Failed to unsubscribe";return setError(message),!1}finally{setIsLoading(!1)}},[isSupported]);return(0,react.useEffect)(()=>{if(!isSupported||"granted"!==permission)return;(async()=>{try{const registration=await navigator.serviceWorker.ready,pushSubscription=await registration.pushManager.getSubscription();if(pushSubscription){const subscriptionJSON=pushSubscription.toJSON();subscriptionJSON.endpoint&&subscriptionJSON.keys&&setSubscription({endpoint:subscriptionJSON.endpoint,keys:{p256dh:subscriptionJSON.keys.p256dh||"",auth:subscriptionJSON.keys.auth||""}})}}catch(err){console.warn("Failed to load push notification subscription:",err)}})()},[isSupported,permission]),{isSupported,permission,subscription,isLoading,error,requestPermission,subscribe,unsubscribe}}function urlBase64ToUint8Array(base64String){const base64=(base64String+"=".repeat((4-base64String.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),rawData=window.atob(base64),outputArray=new Uint8Array(rawData.length);for(let i=0;i<rawData.length;++i)outputArray[i]=rawData.charCodeAt(i);return outputArray}function NotificationPermissionPrompt({onDismiss,variant="banner"}){const{isSupported,permission,isLoading,error,requestPermission}=usePushNotifications(),[isDismissed,setIsDismissed]=(0,react.useState)(!1);if(isDismissed||!isSupported||"granted"===permission)return null;if("denied"===permission)return null;const handleEnable=async()=>{await requestPermission()&&(setIsDismissed(!0),onDismiss?.())},handleDismiss=()=>{setIsDismissed(!0),onDismiss?.()};return"banner"===variant?(0,jsx_runtime.jsxs)("div",{className:"border-[#e2e8f0] border-b bg-[#64748b]/5 px-6 py-4",children:[(0,jsx_runtime.jsxs)("div",{className:"mx-auto flex max-w-5xl items-center justify-between gap-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-4",children:[(0,jsx_runtime.jsx)("div",{className:"flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full bg-[#64748b]",children:(0,jsx_runtime.jsx)(esm_HugeiconsIcon.n,{className:"h-5 w-5 text-[#f8fafc]",icon:index_min.Hl8})}),(0,jsx_runtime.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,jsx_runtime.jsx)("p",{className:"font-semibold text-[#0f172a]",children:"Stay updated with notifications"}),(0,jsx_runtime.jsx)("p",{className:"text-[#94a3b8] text-sm",children:"Get notified about bookings, messages, and important updates"})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-3",children:[(0,jsx_runtime.jsx)("button",{className:"whitespace-nowrap rounded-full bg-[#64748b] px-6 py-2.5 font-semibold text-sm text-[#f8fafc] shadow-[0_6px_18px_rgba(244,74,34,0.22)] transition hover:bg-[#64748b] disabled:cursor-not-allowed disabled:opacity-70",disabled:isLoading,onClick:handleEnable,type:"button",children:isLoading?"Enabling...":"Enable Notifications"}),(0,jsx_runtime.jsx)("button",{"aria-label":"Dismiss",className:"rounded-full p-2 text-[#94a3b8] transition hover:bg-[#f8fafc] hover:text-[#0f172a]",onClick:handleDismiss,type:"button",children:(0,jsx_runtime.jsx)(esm_HugeiconsIcon.n,{className:"h-5 w-5",icon:index_min.bJi})})]})]}),error&&(0,jsx_runtime.jsx)("div",{className:"mx-auto mt-3 max-w-5xl",children:(0,jsx_runtime.jsx)("p",{className:"text-[#64748b] text-sm",children:error})})]}):(0,jsx_runtime.jsx)("div",{className:"rounded-xl border border-[#e2e8f0] bg-[#f8fafc] p-8 shadow-[0_10px_40px_rgba(22,22,22,0.04)]",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-start gap-4",children:[(0,jsx_runtime.jsx)("div",{className:"flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-[#64748b]/10",children:(0,jsx_runtime.jsx)(esm_HugeiconsIcon.n,{className:"h-6 w-6 text-[#64748b]",icon:index_min.Hl8})}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"font-semibold text-[#0f172a] text-xl",children:"Enable push notifications"}),(0,jsx_runtime.jsx)("p",{className:"mt-2 text-base text-[#94a3b8] leading-relaxed",children:"Stay informed about your bookings, new messages, and important updates even when you're not using the app."}),(0,jsx_runtime.jsxs)("div",{className:"mt-4 space-y-2 text-[#94a3b8] text-sm",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{className:"text-[#64748b]",children:"•"}),(0,jsx_runtime.jsx)("span",{children:"Booking confirmations and updates"})]}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{className:"text-[#64748b]",children:"•"}),(0,jsx_runtime.jsx)("span",{children:"New messages from professionals/customers"})]}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{className:"text-[#64748b]",children:"•"}),(0,jsx_runtime.jsx)("span",{children:"Service reminders and completion alerts"})]})]}),(0,jsx_runtime.jsxs)("div",{className:"mt-6 flex items-center gap-3",children:[(0,jsx_runtime.jsx)("button",{className:"inline-flex items-center justify-center rounded-full bg-[#64748b] px-6 py-3 font-semibold text-base text-[#f8fafc] shadow-[0_6px_18px_rgba(244,74,34,0.22)] transition hover:bg-[#64748b] disabled:cursor-not-allowed disabled:opacity-70",disabled:isLoading,onClick:handleEnable,type:"button",children:isLoading?"Enabling...":"Enable Notifications"}),(0,jsx_runtime.jsx)("button",{className:"inline-flex items-center justify-center rounded-full border-2 border-[#e2e8f0] bg-[#f8fafc] px-6 py-3 font-semibold text-base text-[#0f172a] transition hover:border-[#64748b] hover:text-[#64748b]",onClick:handleDismiss,type:"button",children:"Maybe Later"})]}),error&&(0,jsx_runtime.jsx)("div",{className:"mt-4 rounded-xl bg-[#64748b]/10 p-3 text-[#64748b] text-sm",children:error})]})]}),(0,jsx_runtime.jsx)("button",{"aria-label":"Dismiss",className:"rounded-full p-2 text-[#94a3b8] transition hover:bg-[#f8fafc] hover:text-[#0f172a]",onClick:handleDismiss,type:"button",children:(0,jsx_runtime.jsx)(esm_HugeiconsIcon.n,{className:"h-5 w-5",icon:index_min.bJi})})]})})}try{NotificationPermissionPrompt.displayName="NotificationPermissionPrompt",NotificationPermissionPrompt.__docgenInfo={description:"",displayName:"NotificationPermissionPrompt",props:{onDismiss:{defaultValue:null,description:"",name:"onDismiss",required:!1,type:{name:"() => void"}},variant:{defaultValue:{value:"banner"},description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"card"'},{value:'"banner"'}]}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/notifications/notification-permission-prompt.tsx#NotificationPermissionPrompt"]={docgenInfo:NotificationPermissionPrompt.__docgenInfo,name:"NotificationPermissionPrompt",path:"src/components/notifications/notification-permission-prompt.tsx#NotificationPermissionPrompt"})}catch(__react_docgen_typescript_loader_error){}const notification_permission_prompt_stories={title:"Notifications/NotificationPermissionPrompt",component:NotificationPermissionPrompt,parameters:{layout:"padded"},tags:["autodocs"]},Default={},__namedExportsOrder=["Default"]}}]);
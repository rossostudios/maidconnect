"use strict";(self.webpackChunkcasaora=self.webpackChunkcasaora||[]).push([[22668,24081,57016],{"./node_modules/@hugeicons/react/dist/esm/HugeiconsIcon.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{n:()=>HugeiconsIcon});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");const defaultAttributes={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none"},HugeiconsIcon=(0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({color="currentColor",size=24,strokeWidth,absoluteStrokeWidth=!1,className="",altIcon,showAlt=!1,icon,primaryColor,secondaryColor,disableSecondaryOpacity=!1,...rest},ref)=>{const calculatedStrokeWidth=void 0!==strokeWidth?absoluteStrokeWidth?24*Number(strokeWidth)/Number(size):strokeWidth:void 0,strokeProps=void 0!==calculatedStrokeWidth?{strokeWidth:calculatedStrokeWidth,stroke:"currentColor"}:{},elementProps={ref,...defaultAttributes,width:size,height:size,color:primaryColor||color,className,...strokeProps,...rest},svgChildren=[...showAlt&&altIcon?altIcon:icon].sort(([,a],[,b])=>{const hasOpacityA=void 0!==a.opacity;return void 0!==b.opacity?1:hasOpacityA?-1:0}).map(([tag,attrs])=>{const isSecondaryPath=void 0!==attrs.opacity,pathOpacity=isSecondaryPath&&!disableSecondaryOpacity?attrs.opacity:void 0,fillProps=secondaryColor?{...void 0!==attrs.stroke?{stroke:isSecondaryPath?secondaryColor:primaryColor||color}:{fill:isSecondaryPath?secondaryColor:primaryColor||color}}:{};return(0,react__WEBPACK_IMPORTED_MODULE_0__.createElement)(tag,{...attrs,...strokeProps,...fillProps,opacity:pathOpacity,key:attrs.key})});return(0,react__WEBPACK_IMPORTED_MODULE_0__.createElement)("svg",elementProps,svgChildren)});HugeiconsIcon.displayName="HugeiconsIcon"},"./node_modules/next-intl/dist/esm/production/react-client/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c3:()=>e});var use_intl__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/use-intl/dist/esm/production/react.js");function o(r,t){return(...r)=>{try{return t(...r)}catch{throw new Error(void 0)}}}const e=o(0,use_intl__WEBPACK_IMPORTED_MODULE_0__.c3);o(0,use_intl__WEBPACK_IMPORTED_MODULE_0__.kc)},"./src/components/bookings/booking-sheet.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>__WEBPACK_DEFAULT_EXPORT__});const __WEBPACK_DEFAULT_EXPORT__={title:"Bookings/BookingSheet",component:__webpack_require__("./src/components/bookings/booking-sheet.tsx").BookingSheet,parameters:{layout:"padded"},tags:["autodocs"]},Default={},__namedExportsOrder=["Default"]},"./src/components/bookings/booking-sheet.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{BookingSheet:()=>BookingSheet});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),_hugeicons_core_free_icons__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@hugeicons/core-free-icons/dist/esm/index.min.js"),_hugeicons_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@hugeicons/react/dist/esm/HugeiconsIcon.js"),_stripe_react_stripe_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@stripe/react-stripe-js/dist/react-stripe.esm.mjs"),_stripe_stripe_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@stripe/stripe-js/lib/index.mjs"),next_navigation__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.js"),react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),_components_addresses_saved_addresses_manager__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./src/components/addresses/saved-addresses-manager.tsx"),_lib_format__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./src/lib/format.ts"),console=__webpack_require__("./node_modules/console-browserify/index.js");const publishableKey="pk_test_51SDBpLRrYE86buw0Z6tsJBCLyWwQ4ZEGU0Is422C6iXlRsY9eheTM9ZIL5TxItOJ46GzWxGxAXI0QAx0p7ipO9QH00JWbdLFxN",stripePromise=publishableKey?(0,_stripe_stripe_js__WEBPACK_IMPORTED_MODULE_4__.c)(publishableKey):null;function formatTime(time){const[hours=0,minutes=0]=time.split(":").map(Number),period=hours>=12?"PM":"AM";return`${hours%12||12}:${minutes.toString().padStart(2,"0")} ${period}`}function BookingSheet({isOpen,onClose,professionalId,professionalName:_professionalName,selectedDate,availableSlots,services,defaultHourlyRate}){const[selectedTime,setSelectedTime]=(0,react__WEBPACK_IMPORTED_MODULE_6__.useState)(null),[currentStep,setCurrentStep]=(0,react__WEBPACK_IMPORTED_MODULE_6__.useState)("time"),[bookingData,setBookingData]=(0,react__WEBPACK_IMPORTED_MODULE_6__.useState)({serviceName:"",serviceHourlyRate:null,durationHours:2,address:null,customAddress:"",selectedAddons:[],specialInstructions:"",isRecurring:!1}),[addresses,setAddresses]=(0,react__WEBPACK_IMPORTED_MODULE_6__.useState)([]),[addons,setAddons]=(0,react__WEBPACK_IMPORTED_MODULE_6__.useState)([]),[loading,setLoading]=(0,react__WEBPACK_IMPORTED_MODULE_6__.useState)(!1),[error,setError]=(0,react__WEBPACK_IMPORTED_MODULE_6__.useState)(null),[bookingResult,setBookingResult]=(0,react__WEBPACK_IMPORTED_MODULE_6__.useState)(null);(0,react__WEBPACK_IMPORTED_MODULE_6__.useEffect)(()=>{isOpen&&(fetch("/api/customer/addresses").then(res=>res.json()).then(data=>setAddresses(data.addresses||[])).catch(console.error),fetch(`/api/professionals/${professionalId}/addons`).then(res=>res.json()).then(data=>setAddons(data.addons||[])).catch(console.error))},[isOpen,professionalId]),(0,react__WEBPACK_IMPORTED_MODULE_6__.useEffect)(()=>{isOpen||(setSelectedTime(null),setCurrentStep("time"),setError(null))},[isOpen]);const serviceWithName=services.filter(service=>Boolean(service.name)),selectedService=serviceWithName.find(service=>service.name===bookingData.serviceName),selectedRate=bookingData.serviceHourlyRate??selectedService?.hourlyRateCop??defaultHourlyRate??0,baseAmount=selectedRate&&bookingData.durationHours>0?Math.round(selectedRate*bookingData.durationHours):0,addonsTotal=bookingData.selectedAddons.reduce((sum,addon)=>sum+addon.price_cop,0),totalAmount=baseAmount+addonsTotal;return isOpen?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"fade-in fixed inset-0 z-40 animate-in bg-[#0f172a]/40 backdrop-blur-sm duration-300",onClick:onClose,onKeyDown:e=>{"Escape"===e.key&&onClose()},role:"button",tabIndex:0}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"slide-in-from-right fixed inset-y-0 right-0 z-50 w-full animate-in overflow-y-auto bg-[#f8fafc] shadow-2xl duration-500 ease-out md:max-w-2xl",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"sticky top-0 z-10 flex items-center justify-between border-[#e2e8f0] border-b bg-[#f8fafc] px-6 py-5 md:px-8 md:py-6",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("h2",{className:"font-semibold text-[#0f172a] text-xl md:text-2xl",children:["time"===currentStep&&"Choose time","details"===currentStep&&"Booking details","payment"===currentStep&&"Payment"]}),selectedDate&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:"mt-1 text-[#94a3b8] text-sm md:text-base",children:selectedDate.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{"aria-label":"Close booking sheet",className:"flex h-11 w-11 items-center justify-center rounded-full text-[#94a3b8] transition hover:bg-[#e2e8f0]",onClick:onClose,type:"button",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_hugeicons_react__WEBPACK_IMPORTED_MODULE_2__.n,{className:"h-6 w-6",icon:_hugeicons_core_free_icons__WEBPACK_IMPORTED_MODULE_1__.bJi})})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"p-6 md:p-8",children:[error&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"mb-6 rounded-xl border border-[#64748b]/30 bg-[#64748b]/10 px-5 py-4 text-[#64748b] text-base",children:error}),"time"===currentStep&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"fade-in-50 animate-in space-y-6 duration-500",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("h3",{className:"mb-4 font-semibold text-[#0f172a] text-xl",children:"Available times"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:"mb-6 text-[#94a3b8] text-base",children:"Select a time slot to continue with your booking"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-3",children:availableSlots.map((time,index)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{className:"group fade-in-0 slide-in-from-bottom-4 animate-in rounded-xl border-2 border-[#e2e8f0] bg-[#f8fafc] px-5 py-4 font-semibold text-base text-[#0f172a] shadow-sm transition-all duration-300 hover:scale-105 hover:border-[#64748b] hover:bg-[#64748b]/5 hover:shadow-lg active:scale-95 md:px-5 md:py-4",onClick:()=>(time=>{setSelectedTime(time),setCurrentStep("details")})(time),style:{animationDelay:30*index+"ms"},type:"button",children:formatTime(time)},time))})]})}),"details"===currentStep&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"fade-in-50 animate-in space-y-8 duration-500",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"rounded-2xl bg-[#64748b]/5 p-6",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex items-center gap-3 text-[#64748b] text-base",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_hugeicons_react__WEBPACK_IMPORTED_MODULE_2__.n,{className:"h-5 w-5",icon:_hugeicons_core_free_icons__WEBPACK_IMPORTED_MODULE_1__.p19}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"font-semibold",children:selectedTime&&formatTime(selectedTime)}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{className:"ml-auto text-sm underline",onClick:()=>setCurrentStep("time"),type:"button",children:"Change time"})]})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("label",{className:"mb-3 block font-semibold text-base text-[#0f172a] md:text-lg",htmlFor:"service-select",children:"Service *"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("select",{className:"w-full rounded-xl border-2 border-[#e2e8f0] px-4 py-4 text-base focus:border-[#64748b] focus:outline-none focus:ring-2 focus:ring-[#64748b]/20 md:px-5",id:"service-select",onChange:e=>{const service=serviceWithName.find(s=>s.name===e.target.value);setBookingData({...bookingData,serviceName:e.target.value,serviceHourlyRate:service?.hourlyRateCop??null})},required:!0,value:bookingData.serviceName,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("option",{value:"",children:"Select a service"}),serviceWithName.map(service=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("option",{value:service.name??"",children:[service.name,service.hourlyRateCop?` Â· ${(0,_lib_format__WEBPACK_IMPORTED_MODULE_8__.Kq)(service.hourlyRateCop)}/hr`:""]},service.name))]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"mb-3 block font-semibold text-base text-[#0f172a] md:text-lg",children:"Duration *"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex items-center gap-3 md:gap-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{"aria-label":"Decrease duration",className:"flex h-12 w-12 items-center justify-center rounded-xl border-2 border-[#e2e8f0] transition hover:border-[#64748b] hover:bg-[#64748b]/5 md:p-3",onClick:()=>setBookingData({...bookingData,durationHours:Math.max(1,bookingData.durationHours-1)}),type:"button",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_hugeicons_react__WEBPACK_IMPORTED_MODULE_2__.n,{className:"h-5 w-5",icon:_hugeicons_core_free_icons__WEBPACK_IMPORTED_MODULE_1__.VPX})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex-1 rounded-xl border-2 border-[#e2e8f0] bg-[#f8fafc] px-4 py-4 text-center font-semibold text-[#0f172a] text-lg md:px-5 md:text-xl",children:[bookingData.durationHours," ",1===bookingData.durationHours?"hour":"hours"]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{"aria-label":"Increase duration",className:"flex h-12 w-12 items-center justify-center rounded-xl border-2 border-[#e2e8f0] transition hover:border-[#64748b] hover:bg-[#64748b]/5 md:p-3",onClick:()=>setBookingData({...bookingData,durationHours:Math.min(12,bookingData.durationHours+1)}),type:"button",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_hugeicons_react__WEBPACK_IMPORTED_MODULE_2__.n,{className:"h-5 w-5",icon:_hugeicons_core_free_icons__WEBPACK_IMPORTED_MODULE_1__._L6})})]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("label",{className:"mb-3 block font-semibold text-[#0f172a] text-lg",htmlFor:"service-address",children:"Service address *"}),addresses.length>0?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_addresses_saved_addresses_manager__WEBPACK_IMPORTED_MODULE_7__.f,{addresses,onAddressesChange:setAddresses,onAddressSelect:address=>setBookingData({...bookingData,address}),selectedAddressId:bookingData.address?.id,showManagement:!1}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("textarea",{className:"w-full rounded-xl border-2 border-[#e2e8f0] px-5 py-4 text-base focus:border-[#64748b] focus:outline-none focus:ring-2 focus:ring-[#64748b]/20",id:"service-address",onChange:e=>setBookingData({...bookingData,customAddress:e.target.value}),placeholder:"Street, city, building access info...",rows:3,value:bookingData.customAddress})]}),addons.length>0&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"mb-3 block font-semibold text-[#0f172a] text-lg",children:"Add extras (optional)"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"space-y-3",children:addons.map(addon=>{const isSelected=bookingData.selectedAddons.some(a=>a.id===addon.id);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{className:"w-full rounded-xl border-2 p-5 text-left transition "+(isSelected?"border-[#64748b] bg-[#64748b]/5":"border-[#e2e8f0] bg-[#f8fafc] hover:border-[#64748b]/50"),onClick:()=>(addon=>{const isSelected=bookingData.selectedAddons.some(a=>a.id===addon.id);setBookingData({...bookingData,selectedAddons:isSelected?bookingData.selectedAddons.filter(a=>a.id!==addon.id):[...bookingData.selectedAddons,addon]})})(addon),type:"button",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex items-start justify-between",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex-1",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("h4",{className:"font-semibold text-base text-[#0f172a]",children:addon.name}),addon.description&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:"mt-1 text-[#94a3b8] text-sm",children:addon.description})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"ml-4 font-semibold text-[#64748b] text-base",children:(0,_lib_format__WEBPACK_IMPORTED_MODULE_8__.Kq)(addon.price_cop)})]})},addon.id)})})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("label",{className:"mb-3 block font-semibold text-[#0f172a] text-lg",htmlFor:"special-instructions",children:"Special instructions"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("textarea",{className:"w-full rounded-xl border-2 border-[#e2e8f0] px-5 py-4 text-base focus:border-[#64748b] focus:outline-none focus:ring-2 focus:ring-[#64748b]/20",id:"special-instructions",onChange:e=>setBookingData({...bookingData,specialInstructions:e.target.value}),placeholder:"Pets, cleaning priorities, access codes...",rows:3,value:bookingData.specialInstructions})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"rounded-2xl border-2 border-[#e2e8f0] bg-[#f8fafc] p-6",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("h3",{className:"mb-4 font-semibold text-[#0f172a] text-lg",children:"Price summary"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"space-y-3 text-base",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex justify-between",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"text-[#94a3b8]",children:"Service"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"font-semibold text-[#0f172a]",children:(0,_lib_format__WEBPACK_IMPORTED_MODULE_8__.Kq)(baseAmount)})]}),addonsTotal>0&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex justify-between",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"text-[#94a3b8]",children:"Add-ons"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"font-semibold text-[#0f172a]",children:(0,_lib_format__WEBPACK_IMPORTED_MODULE_8__.Kq)(addonsTotal)})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"border-[#e2e8f0] border-t pt-3",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex justify-between text-xl",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"font-semibold text-[#0f172a]",children:"Total"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("span",{className:"font-bold text-[#64748b]",children:(0,_lib_format__WEBPACK_IMPORTED_MODULE_8__.Kq)(totalAmount)})]})})]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:gap-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{className:"order-2 rounded-xl border-2 border-[#e2e8f0] px-8 py-4 font-semibold text-[#94a3b8] text-base transition hover:border-[#64748b] hover:text-[#64748b] md:order-1",onClick:()=>setCurrentStep("time"),type:"button",children:"Back"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{className:"order-1 flex-1 rounded-xl bg-[#64748b] px-8 py-4 font-semibold text-base text-[#f8fafc] transition hover:bg-[#64748b] disabled:cursor-not-allowed disabled:opacity-50 md:order-2",disabled:loading||!bookingData.serviceName||!(bookingData.address||bookingData.customAddress),onClick:async()=>{if(selectedDate&&selectedTime&&bookingData.serviceName){setLoading(!0),setError(null);try{const scheduledStart=new Date(`${selectedDate.toISOString().split("T")[0]}T${selectedTime}:00`),scheduledEnd=new Date(scheduledStart.getTime()+60*bookingData.durationHours*60*1e3),response=await fetch("/api/bookings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({professionalId,serviceName:bookingData.serviceName,serviceHourlyRate:selectedRate,scheduledStart:scheduledStart.toISOString(),scheduledEnd:scheduledEnd.toISOString(),durationMinutes:60*bookingData.durationHours,amount:totalAmount,specialInstructions:bookingData.specialInstructions||void 0,address:bookingData.address?{street:bookingData.address.street,city:bookingData.address.city,neighborhood:bookingData.address.neighborhood,postal_code:bookingData.address.postal_code,building_access:bookingData.address.building_access,parking_info:bookingData.address.parking_info,special_notes:bookingData.address.special_notes}:bookingData.customAddress?{raw:bookingData.customAddress}:void 0,selectedAddons:bookingData.selectedAddons.length>0?bookingData.selectedAddons.map(addon=>({addon_id:addon.id,quantity:1})):void 0,isRecurring:bookingData.isRecurring})});if(!response.ok){const body=await response.json();throw new Error(body.error??"Failed to create booking")}const result=await response.json();setBookingResult(result),setCurrentStep("payment")}catch(err){setError(err instanceof Error?err.message:"Unexpected error")}finally{setLoading(!1)}}else setError("Please complete all required fields")},type:"button",children:loading?"Creating booking...":"Continue to payment"})]})]}),"payment"===currentStep&&bookingResult&&stripePromise&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_stripe_react_stripe_js__WEBPACK_IMPORTED_MODULE_3__.S8,{options:{clientSecret:bookingResult.clientSecret,appearance:{theme:"flat",variables:{colorPrimary:"#64748b",colorText:"#0f172a",borderRadius:"12px"}}},stripe:stripePromise,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(PaymentStep,{bookingId:bookingResult.bookingId,onBack:()=>setCurrentStep("details"),paymentIntentId:bookingResult.paymentIntentId})})]})]})]}):null}function PaymentStep({bookingId,paymentIntentId,onBack}){const stripe=(0,_stripe_react_stripe_js__WEBPACK_IMPORTED_MODULE_3__.t2)(),elements=(0,_stripe_react_stripe_js__WEBPACK_IMPORTED_MODULE_3__.HH)(),router=(0,next_navigation__WEBPACK_IMPORTED_MODULE_5__.useRouter)(),[submitting,setSubmitting]=(0,react__WEBPACK_IMPORTED_MODULE_6__.useState)(!1),[error,setError]=(0,react__WEBPACK_IMPORTED_MODULE_6__.useState)(null);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"space-y-6",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:"text-[#94a3b8] text-base",children:"We'll authorize a hold on your card. You'll only be charged after the service is completed."}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_stripe_react_stripe_js__WEBPACK_IMPORTED_MODULE_3__.He,{}),error&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:"text-[#64748b] text-base",children:error}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:gap-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{className:"order-2 rounded-xl border-2 border-[#e2e8f0] px-8 py-4 font-semibold text-[#94a3b8] text-base transition hover:border-[#64748b] hover:text-[#64748b] disabled:cursor-not-allowed disabled:opacity-50 md:order-1",disabled:submitting,onClick:onBack,type:"button",children:"Back"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{className:"order-1 flex-1 rounded-xl bg-[#64748b] px-8 py-4 font-semibold text-base text-[#f8fafc] transition hover:bg-[#64748b] disabled:cursor-not-allowed disabled:opacity-50 md:order-2",disabled:submitting,onClick:async()=>{if(stripe&&elements){setSubmitting(!0),setError(null);try{const{error:paymentError,paymentIntent}=await stripe.confirmPayment({elements,confirmParams:{return_url:window.location.origin},redirect:"if_required"});if(paymentError)throw new Error(paymentError.message??"Payment requires additional verification.");"requires_capture"===paymentIntent?.status&&await fetch("/api/bookings/authorize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bookingId,paymentIntentId})}),router.push("/dashboard/customer")}catch(err){setError(err instanceof Error?err.message:"Unexpected payment error")}finally{setSubmitting(!1)}}},type:"button",children:submitting?"Confirming...":"Confirm booking"})]})]})}try{BookingSheet.displayName="BookingSheet",BookingSheet.__docgenInfo={description:"",displayName:"BookingSheet",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},professionalId:{defaultValue:null,description:"",name:"professionalId",required:!0,type:{name:"string"}},professionalName:{defaultValue:null,description:"",name:"professionalName",required:!0,type:{name:"string"}},selectedDate:{defaultValue:null,description:"",name:"selectedDate",required:!0,type:{name:"Date"}},availableSlots:{defaultValue:null,description:"",name:"availableSlots",required:!0,type:{name:"string[]"}},services:{defaultValue:null,description:"",name:"services",required:!0,type:{name:"ProfessionalService[]"}},defaultHourlyRate:{defaultValue:null,description:"",name:"defaultHourlyRate",required:!0,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/bookings/booking-sheet.tsx#BookingSheet"]={docgenInfo:BookingSheet.__docgenInfo,name:"BookingSheet",path:"src/components/bookings/booking-sheet.tsx#BookingSheet"})}catch(__react_docgen_typescript_loader_error){}},"./src/lib/format.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function formatCurrency(amount,options={}){const{locale="es-CO",currency="COP",minimumFractionDigits=0,maximumFractionDigits="COP"===currency?0:2}=options,safeAmount=amount??0;return Number.isFinite(safeAmount)?new Intl.NumberFormat(locale,{style:"currency",currency,minimumFractionDigits,maximumFractionDigits}).format(safeAmount):new Intl.NumberFormat(locale,{style:"currency",currency,minimumFractionDigits,maximumFractionDigits}).format(0)}function formatCOP(amount){return formatCurrency(amount,{locale:"es-CO",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0})}function formatDate(date,options={}){if(!date)return"";const{locale="en-US",weekday,year="numeric",month="short",day="numeric"}=options;try{const dateObj="string"==typeof date?new Date(date):date;return!dateObj||Number.isNaN(dateObj.getTime())?"":dateObj.toLocaleDateString(locale,{weekday,year,month,day})}catch{return""}}__webpack_require__.d(__webpack_exports__,{Kq:()=>formatCOP,Yq:()=>formatDate,vv:()=>formatCurrency})}}]);
"use strict";(self.webpackChunkcasaora=self.webpackChunkcasaora||[]).push([[52136,91158],{"./src/components/guest-checkout/guest-signup-prompt.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>guest_signup_prompt_stories});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),navigation=__webpack_require__("./node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),browser_client=__webpack_require__("./src/lib/supabase/browser-client.ts"),console=__webpack_require__("./node_modules/console-browserify/index.js");function getCurrentGuestSession(){try{const sessionData=localStorage.getItem("maidconnect_guest_session");if(!sessionData)return null;const session=JSON.parse(sessionData);return new Date(session.expires_at)<new Date?(clearGuestSession(),null):session}catch(err){return console.error("Error reading guest session:",err),null}}function clearGuestSession(){localStorage.removeItem("maidconnect_guest_token"),localStorage.removeItem("maidconnect_guest_session")}function shouldShowSignupPrompt(){const hasGuestBooking=sessionStorage.getItem("guest_booking_completed"),isGuest=function isGuestMode(){return null!==getCurrentGuestSession()}();return Boolean(hasGuestBooking&&isGuest)}function clearGuestBookingFlag(){sessionStorage.removeItem("guest_booking_completed")}var toast=__webpack_require__("./src/lib/toast.ts"),guest_signup_prompt_console=__webpack_require__("./node_modules/console-browserify/index.js");function GuestSignupPrompt({bookingId}){const[isOpen,setIsOpen]=(0,react.useState)(shouldShowSignupPrompt()),[isLoading,setIsLoading]=(0,react.useState)(!1),[password,setPassword]=(0,react.useState)(""),router=(0,navigation.useRouter)(),guestSession=getCurrentGuestSession();if(!isOpen||!guestSession)return null;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"fixed inset-0 z-50 bg-[#0f172a]/50 backdrop-blur-sm"}),(0,jsx_runtime.jsxs)("div",{className:"-translate-x-1/2 -translate-y-1/2 fixed top-1/2 left-1/2 z-50 w-full max-w-md rounded-3xl border-2 border-[#e2e8f0] bg-[#f8fafc] p-8 shadow-2xl",children:[(0,jsx_runtime.jsxs)("div",{className:"mb-6 text-center",children:[(0,jsx_runtime.jsx)("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-[#64748b]/10",children:(0,jsx_runtime.jsx)("svg",{className:"h-8 w-8 text-[#64748b]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,jsx_runtime.jsx)("path",{d:"M5 13l4 4L19 7",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})})}),(0,jsx_runtime.jsx)("h2",{className:"mb-2 font-bold text-2xl text-[#0f172a]",children:"Booking Confirmed!"}),(0,jsx_runtime.jsx)("p",{className:"text-[#94a3b8] text-base",children:"Create an account to track your booking and enjoy faster checkout next time"})]}),(0,jsx_runtime.jsxs)("form",{className:"space-y-4",onSubmit:async e=>{if(e.preventDefault(),!password||password.length<8)toast.o.error("Password must be at least 8 characters");else{setIsLoading(!0);try{const supabase=(0,browser_client.createSupabaseBrowserClient)(),{data:authData,error:signUpError}=await supabase.auth.signUp({email:guestSession.email,password,options:{data:{full_name:guestSession.full_name}}});if(signUpError)return toast.o.error(signUpError.message),void setIsLoading(!1);if(!authData.user)return toast.o.error("Failed to create account"),void setIsLoading(!1);const success=await async function convertGuestToUser(guestSessionId,userId){try{const supabase=(0,browser_client.createSupabaseBrowserClient)(),{error}=await supabase.rpc("convert_guest_to_user",{p_guest_session_id:guestSessionId,p_user_id:userId});return error?(console.error("Failed to convert guest to user:",error),!1):(clearGuestSession(),!0)}catch(err){return console.error("Error converting guest to user:",err),!1}}(guestSession.id,authData.user.id);if(!success)return toast.o.error("Account created but failed to link booking. Please contact support."),void setIsLoading(!1);toast.o.success("Account created! Welcome to MaidConnect"),clearGuestBookingFlag(),setIsOpen(!1),setTimeout(()=>{router.push("/dashboard/customer"),router.refresh()},1e3)}catch(err){guest_signup_prompt_console.error("Signup error:",err),toast.o.error("Failed to create account. Please try again."),setIsLoading(!1)}}},children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"mb-2 block font-medium text-[#0f172a] text-sm",children:"Email"}),(0,jsx_runtime.jsx)("input",{className:"w-full rounded-lg border border-[#e2e8f0] bg-[#f8fafc] px-4 py-3 text-[#0f172a] text-sm",disabled:!0,readOnly:!0,type:"email",value:guestSession.email})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"mb-2 block font-medium text-[#0f172a] text-sm",htmlFor:"password",children:"Create Password"}),(0,jsx_runtime.jsx)("input",{autoComplete:"new-password",className:"w-full rounded-lg border border-[#e2e8f0] px-4 py-3 text-sm focus:border-[#64748b] focus:outline-none focus:ring-2 focus:ring-[#64748b]/20",disabled:isLoading,id:"password",minLength:8,onChange:e=>setPassword(e.target.value),placeholder:"Minimum 8 characters",required:!0,type:"password",value:password}),(0,jsx_runtime.jsx)("p",{className:"mt-1 text-[#94a3b8] text-xs",children:"Must be at least 8 characters long"})]}),(0,jsx_runtime.jsxs)("div",{className:"rounded-lg bg-[#f8fafc] p-4",children:[(0,jsx_runtime.jsx)("p",{className:"mb-2 font-semibold text-[#0f172a] text-sm",children:"With an account you can:"}),(0,jsx_runtime.jsxs)("ul",{className:"space-y-1 text-[#94a3b8] text-sm",children:[(0,jsx_runtime.jsxs)("li",{className:"flex items-start gap-2",children:[(0,jsx_runtime.jsx)("span",{className:"text-[#64748b]",children:"✓"}),(0,jsx_runtime.jsx)("span",{children:"Track your booking status in real-time"})]}),(0,jsx_runtime.jsxs)("li",{className:"flex items-start gap-2",children:[(0,jsx_runtime.jsx)("span",{className:"text-[#64748b]",children:"✓"}),(0,jsx_runtime.jsx)("span",{children:"Message your professional directly"})]}),(0,jsx_runtime.jsxs)("li",{className:"flex items-start gap-2",children:[(0,jsx_runtime.jsx)("span",{className:"text-[#64748b]",children:"✓"}),(0,jsx_runtime.jsx)("span",{children:"Book again with saved preferences"})]}),(0,jsx_runtime.jsxs)("li",{className:"flex items-start gap-2",children:[(0,jsx_runtime.jsx)("span",{className:"text-[#64748b]",children:"✓"}),(0,jsx_runtime.jsx)("span",{children:"Access booking history and receipts"})]})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-3",children:[(0,jsx_runtime.jsx)("button",{className:"flex-1 rounded-lg border-2 border-[#e2e8f0] bg-[#f8fafc] px-6 py-3 font-semibold text-[#0f172a] text-sm transition hover:border-[#64748b] hover:text-[#64748b]",disabled:isLoading,onClick:()=>{clearGuestBookingFlag(),setIsOpen(!1)},type:"button",children:"Skip for now"}),(0,jsx_runtime.jsx)("button",{className:"flex-1 rounded-lg bg-[#64748b] px-6 py-3 font-semibold text-sm text-[#f8fafc] transition hover:bg-[#64748b] disabled:cursor-not-allowed disabled:opacity-50",disabled:isLoading,type:"submit",children:isLoading?"Creating...":"Create Account"})]})]}),bookingId&&(0,jsx_runtime.jsxs)("p",{className:"mt-4 text-center text-[#94a3b8] text-xs",children:["Booking ID: ",bookingId]})]})]})}try{GuestSignupPrompt.displayName="GuestSignupPrompt",GuestSignupPrompt.__docgenInfo={description:"",displayName:"GuestSignupPrompt",props:{bookingId:{defaultValue:null,description:"",name:"bookingId",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/guest-checkout/guest-signup-prompt.tsx#GuestSignupPrompt"]={docgenInfo:GuestSignupPrompt.__docgenInfo,name:"GuestSignupPrompt",path:"src/components/guest-checkout/guest-signup-prompt.tsx#GuestSignupPrompt"})}catch(__react_docgen_typescript_loader_error){}const guest_signup_prompt_stories={title:"Guest-checkout/GuestSignupPrompt",component:GuestSignupPrompt,parameters:{layout:"padded"},tags:["autodocs"]},Default={},__namedExportsOrder=["Default"]},"./src/lib/supabase/browser-client.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{createSupabaseBrowserClient:()=>createSupabaseBrowserClient});var _supabase_ssr__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@supabase/ssr/dist/module/index.js");function createSupabaseBrowserClient(){const supabaseUrl="https://hvnetxfsrtplextvtwfx.supabase.co",supabaseKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh2bmV0eGZzcnRwbGV4dHZ0d2Z4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1ODc0NTEsImV4cCI6MjA3NzE2MzQ1MX0.7-N06om_ntUuGP1NZ0Zcqz01s975xJfiKno34aIW__o";return(0,_supabase_ssr__WEBPACK_IMPORTED_MODULE_0__.createBrowserClient)(supabaseUrl,supabaseKey)}},"./src/lib/toast.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{l:()=>confirm,o:()=>toast});let toastContainer=null;function showToast(message,options={}){const{duration=3e3,type="info"}=options,container=function getToastContainer(){return toastContainer&&document.body.contains(toastContainer)||(toastContainer=document.createElement("div"),toastContainer.id="toast-container",toastContainer.style.cssText="\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    z-index: 9999;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    pointer-events: none;\n  ",document.body.appendChild(toastContainer)),toastContainer}(),toast=document.createElement("div");if(toast.textContent=message,toast.style.cssText=function getToastStyles(type){return"\n    padding: 12px 20px;\n    border-radius: 8px;\n    font-family: system-ui, -apple-system, sans-serif;\n    font-size: 14px;\n    font-weight: 500;\n    box-shadow: 0 4px 12px rgba(22, 22, 22, 0.15);\n    pointer-events: auto;\n    min-width: 300px;\n    max-width: 500px;\n    word-wrap: break-word;\n    animation: slideIn 0.3s ease-out;\n  "+{success:"background-color: #FF4444A22; color: white;",error:"background-color: #FF4444A22; color: white;",info:"background-color: #FF4444A22; color: white;",warning:"background-color: #FF4444A22; color: white;"}[type]}(type),!document.getElementById("toast-animations")){const style=document.createElement("style");style.id="toast-animations",style.textContent="\n      @keyframes slideIn {\n        from {\n          transform: translateX(100%);\n          opacity: 0;\n        }\n        to {\n          transform: translateX(0);\n          opacity: 1;\n        }\n      }\n      @keyframes slideOut {\n        from {\n          transform: translateX(0);\n          opacity: 1;\n        }\n        to {\n          transform: translateX(100%);\n          opacity: 0;\n        }\n      }\n    ",document.head.appendChild(style)}container.appendChild(toast),setTimeout(()=>{toast.style.animation="slideOut 0.3s ease-in",setTimeout(()=>{toast.parentNode&&toast.parentNode.removeChild(toast),0===container.children.length&&container.parentNode&&(container.parentNode.removeChild(container),toastContainer=null)},300)},duration)}const toast={success:(message,duration)=>showToast(message,{type:"success",duration}),error:(message,duration)=>showToast(message,{type:"error",duration}),info:(message,duration)=>showToast(message,{type:"info",duration}),warning:(message,duration)=>showToast(message,{type:"warning",duration})};function confirm(message,title="Confirm"){return new Promise(resolve=>{const overlay=document.createElement("div");overlay.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background-color: rgba(22, 22, 22, 0.5);\n      z-index: 10000;\n      display: flex;\n      align-items: center;\n      justify-center;\n      animation: fadeIn 0.2s ease-out;\n    ";const modal=document.createElement("div");modal.style.cssText="\n      background-color: white;\n      border-radius: 12px;\n      padding: 24px;\n      max-width: 400px;\n      width: 90%;\n      box-shadow: 0 20px 25px -5px rgba(22, 22, 22, 0.1);\n      animation: scaleIn 0.2s ease-out;\n    ";const titleElement=document.createElement("h3");titleElement.textContent=title,titleElement.style.cssText="\n      font-size: 18px;\n      font-weight: 600;\n      color: #116611616;\n      margin-bottom: 12px;\n    ";const messageElement=document.createElement("p");messageElement.textContent=message,messageElement.style.cssText="\n      font-size: 14px;\n      color: #116611616;\n      margin-bottom: 20px;\n      line-height: 1.5;\n    ";const buttonContainer=document.createElement("div");buttonContainer.style.cssText="\n      display: flex;\n      gap: 12px;\n      justify-content: flex-end;\n    ";const cancelButton=document.createElement("button");cancelButton.textContent="Cancel",cancelButton.style.cssText="\n      padding: 8px 16px;\n      border-radius: 8px;\n      border: 2px solid #EE44EE2E3;\n      background-color: white;\n      color: #116611616;\n      font-weight: 600;\n      font-size: 14px;\n      cursor: pointer;\n      transition: all 0.2s;\n    ",cancelButton.onmouseover=()=>{cancelButton.style.borderColor="#AA88AAAAC",cancelButton.style.color="#AA88AAAAC"},cancelButton.onmouseout=()=>{cancelButton.style.borderColor="#EE44EE2E3",cancelButton.style.color="#116611616"};const confirmButton=document.createElement("button");confirmButton.textContent="Confirm",confirmButton.style.cssText="\n      padding: 8px 16px;\n      border-radius: 8px;\n      border: none;\n      background-color: #AA88AAAAC;\n      color: white;\n      font-weight: 600;\n      font-size: 14px;\n      cursor: pointer;\n      transition: all 0.2s;\n    ",confirmButton.onmouseover=()=>{confirmButton.style.backgroundColor="#AA88AAAAC"},confirmButton.onmouseout=()=>{confirmButton.style.backgroundColor="#AA88AAAAC"};const cleanup=()=>{overlay.style.animation="fadeOut 0.2s ease-in",setTimeout(()=>{overlay.parentNode&&overlay.parentNode.removeChild(overlay)},200)};if(cancelButton.onclick=()=>{cleanup(),resolve(!1)},confirmButton.onclick=()=>{cleanup(),resolve(!0)},!document.getElementById("modal-animations")){const style=document.createElement("style");style.id="modal-animations",style.textContent="\n        @keyframes fadeIn {\n          from { opacity: 0; }\n          to { opacity: 1; }\n        }\n        @keyframes fadeOut {\n          from { opacity: 1; }\n          to { opacity: 0; }\n        }\n        @keyframes scaleIn {\n          from {\n            transform: scale(0.9);\n            opacity: 0;\n          }\n          to {\n            transform: scale(1);\n            opacity: 1;\n          }\n        }\n      ",document.head.appendChild(style)}buttonContainer.appendChild(cancelButton),buttonContainer.appendChild(confirmButton),modal.appendChild(titleElement),modal.appendChild(messageElement),modal.appendChild(buttonContainer),overlay.appendChild(modal),document.body.appendChild(overlay),confirmButton.focus()})}}}]);
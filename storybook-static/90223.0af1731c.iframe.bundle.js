"use strict";(self.webpackChunkcasaora=self.webpackChunkcasaora||[]).push([[90223],{"./src/components/notifications/notifications-sheet.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{NotificationsSheet:()=>NotificationsSheet});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),_barrel_optimize_names_formatDistanceToNow_date_fns__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/date-fns/formatDistanceToNow.js"),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),_i18n_routing__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/i18n/routing.ts"),console=__webpack_require__("./node_modules/console-browserify/index.js");function NotificationsSheet({isOpen,onClose}){const[notifications,setNotifications]=(0,react__WEBPACK_IMPORTED_MODULE_2__.useState)([]),[loading,setLoading]=(0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(!0),[filter,setFilter]=(0,react__WEBPACK_IMPORTED_MODULE_2__.useState)("unread"),fetchNotifications=(0,react__WEBPACK_IMPORTED_MODULE_2__.useCallback)(async()=>{try{setLoading(!0);const params=new URLSearchParams({limit:"20",offset:"0"});"unread"===filter&&params.set("unreadOnly","true");const response=await fetch(`/api/notifications/history?${params}`);if(!response.ok)throw new Error("Failed to fetch notifications");const data=await response.json();setNotifications(data.notifications||[])}catch(err){console.warn("Failed to fetch notifications:",err)}finally{setLoading(!1)}},[filter]);(0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(()=>{isOpen&&fetchNotifications()},[isOpen,fetchNotifications]);const markAsRead=async notificationIds=>{try{if(!(await fetch("/api/notifications/mark-read",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notificationIds})})).ok)throw new Error("Failed to mark as read");setNotifications(prev=>prev.map(notif=>notificationIds.includes(notif.id)?{...notif,read_at:(new Date).toISOString()}:notif))}catch(err){console.warn("Failed to mark notifications as read:",err)}},unreadCount=notifications.filter(n=>!n.read_at).length;return isOpen?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"fixed inset-0 z-40 bg-[#0f172a]/20",onClick:onClose,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),onClose())},role:"button",tabIndex:0}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"fixed top-0 right-0 z-50 flex h-full w-full max-w-md flex-col bg-[#f8fafc] shadow-2xl",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex items-center justify-between border-[#e2e8f0] border-b px-6 py-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("h2",{className:"font-semibold text-[#0f172a] text-xl",children:"Notifications"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{className:"rounded-lg p-2 text-[#94a3b8] transition hover:bg-[#f8fafc]",onClick:onClose,type:"button",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("svg",{"aria-hidden":"true",className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("path",{d:"M6 18L18 6M6 6l12 12",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})})})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex items-center justify-between border-[#e2e8f0] border-b px-6 py-3",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex gap-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("button",{className:"font-medium text-sm transition "+("unread"===filter?"text-[#0f172a]":"text-[#94a3b8] hover:text-[#0f172a]"),onClick:()=>setFilter("unread"),type:"button",children:["Unread ",unreadCount>0&&`(${unreadCount})`]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{className:"font-medium text-sm transition "+("all"===filter?"text-[#0f172a]":"text-[#94a3b8] hover:text-[#0f172a]"),onClick:()=>setFilter("all"),type:"button",children:"All"})]}),unreadCount>0&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{className:"font-medium text-[#64748b] text-xs transition hover:text-[#64748b]",onClick:async()=>{try{if(!(await fetch("/api/notifications/mark-read",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({markAllRead:!0})})).ok)throw new Error("Failed to mark all as read");await fetchNotifications()}catch(err){console.warn("Failed to mark all notifications as read:",err)}},type:"button",children:"Mark all read"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"flex-1 overflow-y-auto",children:loading?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"flex items-center justify-center p-12",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-[#64748b] border-b-2"})}):0===notifications.length?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex flex-col items-center justify-center p-12",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-[#f8fafc]",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("svg",{"aria-hidden":"true",className:"h-8 w-8 text-[#94a3b8]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("path",{d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2})})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("h3",{className:"font-semibold text-base text-[#0f172a]",children:"unread"===filter?"All caught up!":"No notifications"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:"mt-1 text-center text-[#94a3b8] text-sm",children:"unread"===filter?"You've read all your notifications":"You'll see notifications here when there's activity"})]}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"divide-y divide-[#e2e8f0]",children:notifications.map(notification=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"p-4 transition hover:bg-[#f8fafc] "+(notification.read_at?"":"bg-[#64748b]/5"),children:notification.url?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_i18n_routing__WEBPACK_IMPORTED_MODULE_3__.N_,{className:"block",href:notification.url,onClick:()=>{markAsRead([notification.id]),onClose()},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:"font-semibold text-[#0f172a] text-sm",children:notification.title}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:"mt-1 text-[#94a3b8] text-sm",children:notification.body}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:"mt-1 text-[#94a3b8] text-xs",children:(0,_barrel_optimize_names_formatDistanceToNow_date_fns__WEBPACK_IMPORTED_MODULE_1__.m)(new Date(notification.created_at),{addSuffix:!0})})]}),!notification.read_at&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"mt-1 h-2 w-2 flex-shrink-0 rounded-full bg-[#64748b]"})]})}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:"font-semibold text-[#0f172a] text-sm",children:notification.title}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:"mt-1 text-[#94a3b8] text-sm",children:notification.body}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:"mt-1 text-[#94a3b8] text-xs",children:(0,_barrel_optimize_names_formatDistanceToNow_date_fns__WEBPACK_IMPORTED_MODULE_1__.m)(new Date(notification.created_at),{addSuffix:!0})})]}),!notification.read_at&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("button",{className:"mt-1 h-2 w-2 flex-shrink-0 rounded-full bg-[#64748b] transition hover:bg-[#64748b]",onClick:()=>markAsRead([notification.id]),type:"button"})]})},notification.id))})})]})]}):null}try{NotificationsSheet.displayName="NotificationsSheet",NotificationsSheet.__docgenInfo={description:"",displayName:"NotificationsSheet",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/notifications/notifications-sheet.tsx#NotificationsSheet"]={docgenInfo:NotificationsSheet.__docgenInfo,name:"NotificationsSheet",path:"src/components/notifications/notifications-sheet.tsx#NotificationsSheet"})}catch(__react_docgen_typescript_loader_error){}}}]);
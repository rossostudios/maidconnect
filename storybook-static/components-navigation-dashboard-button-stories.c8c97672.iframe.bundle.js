"use strict";(self.webpackChunkcasaora=self.webpackChunkcasaora||[]).push([[28874],{"./src/components/navigation/dashboard-button.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{CustomLabel:()=>CustomLabel,Default:()=>Default,LongLabel:()=>LongLabel,WithUnreadBadge:()=>WithUnreadBadge,__namedExportsOrder:()=>__namedExportsOrder,default:()=>dashboard_button_stories});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),routing=__webpack_require__("./src/i18n/routing.ts"),use_unread_count=__webpack_require__("./src/hooks/use-unread-count.ts"),utils=__webpack_require__("./src/lib/utils.ts");function DashboardButton({href,label="Dashboard",className}){const{unreadCount}=(0,use_unread_count.U)();return(0,jsx_runtime.jsxs)("div",{className:"relative inline-block",children:[(0,jsx_runtime.jsx)(routing.N_,{href,className:(0,utils.cn)("inline-flex items-center justify-center rounded-lg border border-slate-300 bg-white px-4 py-2 text-sm font-medium text-slate-900 shadow-sm transition hover:bg-slate-50 hover:border-slate-400 active:bg-slate-100",className),children:label}),unreadCount>0&&(0,jsx_runtime.jsx)("span",{className:"absolute -right-1 -top-1 flex h-5 min-w-[20px] items-center justify-center rounded-full bg-slate-900 px-1.5 text-xs font-bold text-white",children:unreadCount>99?"99+":unreadCount})]})}try{DashboardButton.displayName="DashboardButton",DashboardButton.__docgenInfo={description:"",displayName:"DashboardButton",props:{href:{defaultValue:null,description:"",name:"href",required:!0,type:{name:"string"}},label:{defaultValue:{value:"Dashboard"},description:"",name:"label",required:!1,type:{name:"string"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/navigation/dashboard-button.tsx#DashboardButton"]={docgenInfo:DashboardButton.__docgenInfo,name:"DashboardButton",path:"src/components/navigation/dashboard-button.tsx#DashboardButton"})}catch(__react_docgen_typescript_loader_error){}const dashboard_button_stories={title:"Navigation/DashboardButton",component:DashboardButton,parameters:{layout:"centered"},tags:["autodocs"],argTypes:{href:{control:"text",description:"The destination URL for the dashboard"},label:{control:"text",description:"The button label text"}}},Default={args:{href:"/dashboard/customer",label:"Dashboard"}},WithUnreadBadge={args:{href:"/dashboard/customer",label:"Dashboard"},parameters:{mockData:{unreadCount:5}}},CustomLabel={args:{href:"/dashboard/pro",label:"Pro Dashboard"}},LongLabel={args:{href:"/dashboard",label:"Professional Dashboard"}},__namedExportsOrder=["Default","WithUnreadBadge","CustomLabel","LongLabel"]},"./src/hooks/use-unread-count.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{U:()=>useUnreadCount});var _tanstack_react_query__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@tanstack/react-query/build/modern/useQuery.js"),_tanstack_react_query__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js"),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),console=__webpack_require__("./node_modules/console-browserify/index.js");function useUnreadCount(){const queryClient=(0,_tanstack_react_query__WEBPACK_IMPORTED_MODULE_1__.jE)(),{data,isLoading,error,refetch}=(0,_tanstack_react_query__WEBPACK_IMPORTED_MODULE_0__.I)({queryKey:["messages","unread-count"],queryFn:async()=>{const response=await fetch("/api/messages/unread-count");if(!response.ok)throw new Error("Failed to fetch unread count");return(await response.json()).unreadCount||0},staleTime:3e4,refetchInterval:6e4,refetchOnWindowFocus:!1});return(0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(()=>{Promise.all([__webpack_require__.e(60921),__webpack_require__.e(52136)]).then(__webpack_require__.bind(__webpack_require__,"./src/lib/supabase/browser-client.ts")).then(({createSupabaseBrowserClient})=>{const supabase=createSupabaseBrowserClient(),channel=supabase.channel("unread-count-updates").on("postgres_changes",{event:"*",schema:"public",table:"conversations"},()=>{queryClient.invalidateQueries({queryKey:["messages","unread-count"]})}).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},()=>{queryClient.invalidateQueries({queryKey:["messages","unread-count"]})}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"messages"},()=>{queryClient.invalidateQueries({queryKey:["messages","unread-count"]})}).subscribe(status=>{"CHANNEL_ERROR"===status&&console.warn("Messages unread count channel error")});return()=>{supabase.removeChannel(channel)}})},[queryClient]),{unreadCount:data??0,isLoading,error:error?error instanceof Error?error.message:"Unknown error":null,refresh:()=>refetch()}}},"./src/i18n/routing.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{DT:()=>routing,N_:()=>Link,a8:()=>usePathname,rd:()=>useRouter});var next_intl_navigation__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next-intl/dist/esm/production/navigation/react-client/createNavigation.js");const routing=(0,__webpack_require__("./node_modules/next-intl/dist/esm/production/routing/defineRouting.js").A)({locales:["en","es"],defaultLocale:"en",localeCookie:{name:"NEXT_LOCALE",maxAge:31536e3}}),{Link,redirect,usePathname,useRouter}=(0,next_intl_navigation__WEBPACK_IMPORTED_MODULE_0__.A)(routing)},"./src/lib/utils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function cn(...classes){return classes.filter(Boolean).join(" ")}__webpack_require__.d(__webpack_exports__,{cn:()=>cn})}}]);
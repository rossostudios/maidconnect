"use strict";(self.webpackChunkcasaora=self.webpackChunkcasaora||[]).push([[24081,43552,52136],{"./node_modules/@hugeicons/react/dist/esm/HugeiconsIcon.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{n:()=>HugeiconsIcon});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");const defaultAttributes={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none"},HugeiconsIcon=(0,react__WEBPACK_IMPORTED_MODULE_0__.forwardRef)(({color="currentColor",size=24,strokeWidth,absoluteStrokeWidth=!1,className="",altIcon,showAlt=!1,icon,primaryColor,secondaryColor,disableSecondaryOpacity=!1,...rest},ref)=>{const calculatedStrokeWidth=void 0!==strokeWidth?absoluteStrokeWidth?24*Number(strokeWidth)/Number(size):strokeWidth:void 0,strokeProps=void 0!==calculatedStrokeWidth?{strokeWidth:calculatedStrokeWidth,stroke:"currentColor"}:{},elementProps={ref,...defaultAttributes,width:size,height:size,color:primaryColor||color,className,...strokeProps,...rest},svgChildren=[...showAlt&&altIcon?altIcon:icon].sort(([,a],[,b])=>{const hasOpacityA=void 0!==a.opacity;return void 0!==b.opacity?1:hasOpacityA?-1:0}).map(([tag,attrs])=>{const isSecondaryPath=void 0!==attrs.opacity,pathOpacity=isSecondaryPath&&!disableSecondaryOpacity?attrs.opacity:void 0,fillProps=secondaryColor?{...void 0!==attrs.stroke?{stroke:isSecondaryPath?secondaryColor:primaryColor||color}:{fill:isSecondaryPath?secondaryColor:primaryColor||color}}:{};return(0,react__WEBPACK_IMPORTED_MODULE_0__.createElement)(tag,{...attrs,...strokeProps,...fillProps,opacity:pathOpacity,key:attrs.key})});return(0,react__WEBPACK_IMPORTED_MODULE_0__.createElement)("svg",elementProps,svgChildren)});HugeiconsIcon.displayName="HugeiconsIcon"},"./node_modules/class-variance-authority/dist/index.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{F:()=>cva});var clsx__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/clsx/dist/clsx.mjs");const falsyToString=value=>"boolean"==typeof value?`${value}`:0===value?"0":value,cx=clsx__WEBPACK_IMPORTED_MODULE_0__.$,cva=(base,config)=>props=>{var _config_compoundVariants;if(null==(null==config?void 0:config.variants))return cx(base,null==props?void 0:props.class,null==props?void 0:props.className);const{variants,defaultVariants}=config,getVariantClassNames=Object.keys(variants).map(variant=>{const variantProp=null==props?void 0:props[variant],defaultVariantProp=null==defaultVariants?void 0:defaultVariants[variant];if(null===variantProp)return null;const variantKey=falsyToString(variantProp)||falsyToString(defaultVariantProp);return variants[variant][variantKey]}),propsWithoutUndefined=props&&Object.entries(props).reduce((acc,param)=>{let[key,value]=param;return void 0===value||(acc[key]=value),acc},{}),getCompoundVariantClassNames=null==config||null===(_config_compoundVariants=config.compoundVariants)||void 0===_config_compoundVariants?void 0:_config_compoundVariants.reduce((acc,param)=>{let{class:cvClass,className:cvClassName,...compoundVariantOptions}=param;return Object.entries(compoundVariantOptions).every(param=>{let[key,value]=param;return Array.isArray(value)?value.includes({...defaultVariants,...propsWithoutUndefined}[key]):{...defaultVariants,...propsWithoutUndefined}[key]===value})?[...acc,cvClass,cvClassName]:acc},[]);return cx(base,getVariantClassNames,getCompoundVariantClassNames,null==props?void 0:props.class,null==props?void 0:props.className)}},"./node_modules/clsx/dist/clsx.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function r(e){var t,f,n="";if("string"==typeof e||"number"==typeof e)n+=e;else if("object"==typeof e)if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(f=r(e[t]))&&(n&&(n+=" "),n+=f)}else for(f in e)e[f]&&(n&&(n+=" "),n+=f);return n}function clsx(){for(var e,t,f=0,n="",o=arguments.length;f<o;f++)(e=arguments[f])&&(t=r(e))&&(n&&(n+=" "),n+=t);return n}__webpack_require__.d(__webpack_exports__,{$:()=>clsx})},"./node_modules/next-intl/dist/esm/production/react-client/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c3:()=>e});var use_intl__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/use-intl/dist/esm/production/react.js");function o(r,t){return(...r)=>{try{return t(...r)}catch{throw new Error(void 0)}}}const e=o(0,use_intl__WEBPACK_IMPORTED_MODULE_0__.c3);o(0,use_intl__WEBPACK_IMPORTED_MODULE_0__.kc)},"./src/components/bookings/enhanced-booking-form.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>enhanced_booking_form_stories});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react_stripe_esm=__webpack_require__("./node_modules/@stripe/react-stripe-js/dist/react-stripe.esm.mjs"),lib=__webpack_require__("./node_modules/@stripe/stripe-js/lib/index.mjs"),navigation=__webpack_require__("./node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),saved_addresses_manager=__webpack_require__("./src/components/addresses/saved-addresses-manager.tsx"),price_breakdown=__webpack_require__("./src/components/pricing/price-breakdown.tsx"),console=__webpack_require__("./node_modules/console-browserify/index.js");var use_feature_flag=__webpack_require__("./src/hooks/use-feature-flag.ts"),browser_client=__webpack_require__("./src/lib/supabase/browser-client.ts"),track_event_console=__webpack_require__("./node_modules/console-browserify/index.js");var format=__webpack_require__("./src/lib/format.ts");function formatCurrencyCOP(value){return(0,format.Kq)(value)}const publishableKey="pk_test_51SDBpLRrYE86buw0Z6tsJBCLyWwQ4ZEGU0Is422C6iXlRsY9eheTM9ZIL5TxItOJ46GzWxGxAXI0QAx0p7ipO9QH00JWbdLFxN",stripePromise=publishableKey?(0,lib.c)(publishableKey):null;function EnhancedBookingForm({professionalId,professionalName,services,defaultHourlyRate,savedAddresses=[],availableAddons=[]}){const[currentStep,setCurrentStep]=(0,react.useState)("service-details"),[bookingData,setBookingData]=(0,react.useState)({serviceName:"",serviceHourlyRate:null,selectedDate:null,selectedTime:null,durationHours:2,address:null,selectedAddons:[],specialInstructions:"",isRecurring:!1}),{addresses,addons,handleAddressesChange}=function useAddressesAndAddons({professionalId,initialAddresses=[],initialAddons=[]}){const[addresses,setAddresses]=(0,react.useState)(initialAddresses),[addons,setAddons]=(0,react.useState)(initialAddons);return(0,react.useEffect)(()=>{0===initialAddresses.length&&fetch("/api/customer/addresses").then(res=>res.json()).then(data=>setAddresses(data.addresses||[])).catch(console.error)},[initialAddresses]),(0,react.useEffect)(()=>{0===initialAddons.length&&fetch(`/api/professionals/${professionalId}/addons`).then(res=>res.json()).then(data=>setAddons(data.addons||[])).catch(console.error)},[professionalId,initialAddons]),{addresses,addons,handleAddressesChange:async newAddresses=>{setAddresses(newAddresses);try{await fetch("/api/customer/addresses",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({addresses:newAddresses})})}catch(_err){}}}}({professionalId,initialAddresses:savedAddresses,initialAddons:availableAddons}),{submissionState,submitAction,isPending}=function useBookingSubmission({professionalId,services,defaultHourlyRate,onSuccess}){const[submissionState,submitAction,isPending]=(0,react.useActionState)(async(_prevState,formData)=>{try{const scheduledStart=new Date(`${formData.selectedDate?.toISOString().split("T")[0]}T${formData.selectedTime}:00`),scheduledEnd=new Date(scheduledStart.getTime()+60*formData.durationHours*60*1e3),selectedRate=formData.serviceHourlyRate??services.find(s=>s.name===formData.serviceName)?.hourlyRateCop??defaultHourlyRate??0,totalAmount=(selectedRate&&formData.durationHours>0?Math.round(selectedRate*formData.durationHours):0)+formData.selectedAddons.reduce((sum,addon)=>sum+addon.price_cop,0),response=await fetch("/api/bookings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({professionalId,serviceName:formData.serviceName,serviceHourlyRate:selectedRate,scheduledStart:scheduledStart.toISOString(),scheduledEnd:scheduledEnd.toISOString(),durationMinutes:60*formData.durationHours,amount:totalAmount,specialInstructions:formData.specialInstructions||void 0,address:formData.address?{street:formData.address.street,city:formData.address.city,neighborhood:formData.address.neighborhood,postal_code:formData.address.postal_code,building_access:formData.address.building_access,parking_info:formData.address.parking_info,special_notes:formData.address.special_notes}:formData.customAddress?{raw:formData.customAddress}:void 0,selectedAddons:formData.selectedAddons.length>0?formData.selectedAddons.map(addon=>({addon_id:addon.id,quantity:1})):void 0,isRecurring:formData.isRecurring,recurrencePattern:formData.recurrencePattern})});if(!response.ok){const body=await response.json();throw new Error(body.error??"Failed to create booking")}return{status:"success",error:null,result:await response.json()}}catch(err){return{status:"error",error:err instanceof Error?err.message:"Unexpected error",result:null}}},{status:"idle",error:null,result:null});return(0,react.useEffect)(()=>{"success"===submissionState.status&&onSuccess&&onSuccess()},[submissionState.status,onSuccess]),{submissionState,submitAction,isPending}}({professionalId,services,defaultHourlyRate,onSuccess:()=>setCurrentStep("payment")}),serviceWithName=services.filter(service=>Boolean(service.name));if(0===serviceWithName.length)return(0,jsx_runtime.jsx)("div",{className:"rounded-2xl border border-[#f8fafc] bg-[#f8fafc] p-5 text-[#94a3b8] text-sm",children:"This professional is updating their services. Check back soon."});if(!stripePromise)return(0,jsx_runtime.jsx)("div",{className:"rounded-lg border border-[#64748b]/30 bg-[#64748b]/10 px-4 py-3 text-[#64748b] text-sm",children:"Payment system not configured."});const selectedService=serviceWithName.find(service=>function normalizeServiceName(value){return value||""}(service.name)===bookingData.serviceName),selectedRate=bookingData.serviceHourlyRate??selectedService?.hourlyRateCop??defaultHourlyRate??0,baseAmount=selectedRate&&bookingData.durationHours>0?Math.round(selectedRate*bookingData.durationHours):0,addonsTotal=bookingData.selectedAddons.reduce((sum,addon)=>sum+addon.price_cop,0),totalAmount=baseAmount+addonsTotal;(0,react.useEffect)(()=>{"confirmation"===currentStep&&async function trackEvent(eventType,properties,userId,sessionId){try{const supabase=(0,browser_client.createSupabaseBrowserClient)();let finalUserId=userId;if(!finalUserId){const{data:{user}}=await supabase.auth.getUser();finalUserId=user?.id}let finalSessionId=sessionId;finalSessionId||(finalSessionId=sessionStorage.getItem("analytics_session_id")??void 0,finalSessionId||(finalSessionId=crypto.randomUUID(),sessionStorage.setItem("analytics_session_id",finalSessionId)));const{error}=await supabase.from("platform_events").insert({event_type:eventType,user_id:finalUserId||null,session_id:finalSessionId,properties});error&&track_event_console.error(`Failed to track event ${eventType}:`,error)}catch(err){track_event_console.error(`Error tracking event ${eventType}:`,err)}}("CheckoutStarted",{pro_id:professionalId,items:[bookingData.serviceName,...bookingData.selectedAddons.map(a=>a.name)],subtotal:totalAmount,deposit_type:"preauth"})},[currentStep,professionalId,bookingData.serviceName,bookingData.selectedAddons,totalAmount]);return(0,jsx_runtime.jsxs)("div",{className:"space-y-6",children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-between",children:[{key:"service-details",label:"Service & Time"},{key:"address-addons",label:"Location & Add-ons"},{key:"confirmation",label:"Review"},{key:"payment",label:"Payment"}].map((step,index)=>(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[(0,jsx_runtime.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-full font-semibold text-xs "+(currentStep===step.key?"bg-[#64748b] text-[#f8fafc]":index<["service-details","address-addons","confirmation","payment"].indexOf(currentStep)?"bg-[#0f172a] text-[#f8fafc]":"bg-[#e2e8f0] text-[#94a3b8]"),children:index+1}),(0,jsx_runtime.jsx)("span",{className:"ml-2 hidden text-[#94a3b8] text-xs sm:block",children:step.label})]},step.key))}),submissionState.error&&(0,jsx_runtime.jsx)("div",{className:"rounded-md border border-[#64748b]/30 bg-[#64748b]/10 px-3 py-2 text-[#64748b] text-sm",children:submissionState.error}),"service-details"===currentStep&&(0,jsx_runtime.jsx)(ServiceDetailsStep,{bookingData,onNext:()=>setCurrentStep("address-addons"),services:serviceWithName,setBookingData}),"address-addons"===currentStep&&(0,jsx_runtime.jsx)(AddressAddonsStep,{addons,addresses,bookingData,onAddressesChange:handleAddressesChange,onBack:()=>setCurrentStep("service-details"),onNext:()=>setCurrentStep("confirmation"),setBookingData}),"confirmation"===currentStep&&(0,jsx_runtime.jsx)(ConfirmationStep,{addonsTotal,baseAmount,bookingData,loading:isPending,onBack:()=>setCurrentStep("address-addons"),onConfirm:()=>{bookingData.selectedDate&&bookingData.selectedTime&&bookingData.serviceName&&submitAction(bookingData)},professionalName,totalAmount}),"payment"===currentStep&&submissionState.result&&(0,jsx_runtime.jsx)(react_stripe_esm.S8,{options:{clientSecret:submissionState.result.clientSecret,appearance:stripeAppearance},stripe:stripePromise,children:(0,jsx_runtime.jsx)(PaymentConfirmation,{bookingId:submissionState.result.bookingId,onReset:()=>window.location.reload(),paymentIntentId:submissionState.result.paymentIntentId})})]})}function ServiceDetailsStep({services,bookingData,setBookingData,onNext}){const canProceed=bookingData.serviceName&&bookingData.selectedDate&&bookingData.selectedTime&&bookingData.durationHours>0;return(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)("h3",{className:"font-semibold text-[#0f172a] text-lg",children:"Choose Service & Time"}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"mb-2 block font-medium text-[#0f172a] text-sm",htmlFor:"enhanced-service-select",children:"Service *"}),(0,jsx_runtime.jsxs)("select",{className:"w-full rounded-md border border-[#e2e8f0] px-3 py-2 text-sm focus:border-[#64748b] focus:outline-none focus:ring-2 focus:ring-[#64748b]/20",id:"enhanced-service-select",onChange:e=>{const service=services.find(s=>s.name===e.target.value);setBookingData({...bookingData,serviceName:e.target.value,serviceHourlyRate:service?.hourlyRateCop??null})},required:!0,value:bookingData.serviceName,children:[(0,jsx_runtime.jsx)("option",{value:"",children:"Select a service"}),services.map(service=>(0,jsx_runtime.jsxs)("option",{value:service.name??"",children:[service.name,service.hourlyRateCop?` Â· ${formatCurrencyCOP(service.hourlyRateCop)}/hr`:""]},service.name))]})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"mb-2 block font-medium text-[#0f172a] text-sm",htmlFor:"duration-hours",children:"Duration (hours) *"}),(0,jsx_runtime.jsx)("input",{className:"w-full rounded-md border border-[#e2e8f0] px-3 py-2 text-sm focus:border-[#64748b] focus:outline-none focus:ring-2 focus:ring-[#64748b]/20",id:"duration-hours",max:12,min:1,onChange:e=>setBookingData({...bookingData,durationHours:Number.parseInt(e.target.value,10)||0}),required:!0,type:"number",value:bookingData.durationHours})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"mb-2 block font-medium text-[slate-900] text-sm",children:"Select Date & Time *"}),(0,jsx_runtime.jsx)("div",{className:"rounded-lg border-2 border-[slate-200] bg-white p-4",children:(0,jsx_runtime.jsx)("p",{className:"text-[slate-500] text-sm",children:"Calendar integration coming soon"})})]}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsxs)("label",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("input",{checked:bookingData.isRecurring,className:"rounded",onChange:e=>setBookingData({...bookingData,isRecurring:e.target.checked}),type:"checkbox"}),(0,jsx_runtime.jsx)("span",{className:"text-[#0f172a] text-sm",children:"Make this a recurring booking"})]})}),bookingData.isRecurring&&(0,jsx_runtime.jsxs)("div",{className:"rounded-lg border border-[#e2e8f0] bg-[#f8fafc]/90 p-4",children:[(0,jsx_runtime.jsx)("label",{className:"mb-2 block font-medium text-[#0f172a] text-sm",htmlFor:"recurrence-frequency",children:"Frequency"}),(0,jsx_runtime.jsxs)("select",{className:"w-full rounded-md border border-[#e2e8f0] px-3 py-2 text-sm focus:border-[#64748b] focus:outline-none focus:ring-2 focus:ring-[#64748b]/20",id:"recurrence-frequency",onChange:e=>setBookingData({...bookingData,recurrencePattern:{frequency:e.target.value}}),value:bookingData.recurrencePattern?.frequency||"weekly",children:[(0,jsx_runtime.jsx)("option",{value:"weekly",children:"Weekly"}),(0,jsx_runtime.jsx)("option",{value:"biweekly",children:"Every 2 weeks"}),(0,jsx_runtime.jsx)("option",{value:"monthly",children:"Monthly"})]})]}),(0,jsx_runtime.jsx)("div",{className:"flex justify-end",children:(0,jsx_runtime.jsx)("button",{className:"rounded-md bg-[#64748b] px-6 py-2 font-semibold text-sm text-[#f8fafc] transition hover:bg-[#64748b] disabled:cursor-not-allowed disabled:opacity-50",disabled:!canProceed,onClick:onNext,type:"button",children:"Continue to Location & Add-ons â†’"})})]})}function AddressAddonsStep({bookingData,setBookingData,addresses,onAddressesChange,addons,onBack,onNext}){const[useCustomAddress,setUseCustomAddress]=(0,react.useState)(!1),canProceed=bookingData.address||bookingData.customAddress;return(0,jsx_runtime.jsxs)("div",{className:"space-y-6",children:[(0,jsx_runtime.jsx)("h3",{className:"font-semibold text-[#0f172a] text-lg",children:"Location & Add-ons"}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"mb-2 block font-medium text-[#0f172a] text-sm",htmlFor:"custom-address-enhanced",children:"Service Address *"}),!useCustomAddress&&addresses.length>0&&(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsx)(saved_addresses_manager.f,{addresses,onAddressesChange,onAddressSelect:address=>setBookingData({...bookingData,address}),selectedAddressId:bookingData.address?.id,showManagement:!1}),(0,jsx_runtime.jsx)("button",{className:"text-[#64748b] text-sm hover:text-[#64748b]",onClick:()=>setUseCustomAddress(!0),type:"button",children:"+ Enter a different address"})]}),(useCustomAddress||0===addresses.length)&&(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsx)("textarea",{className:"w-full rounded-md border border-[#e2e8f0] px-3 py-2 text-sm focus:border-[#64748b] focus:outline-none focus:ring-2 focus:ring-[#64748b]/20",id:"custom-address-enhanced",onChange:e=>setBookingData({...bookingData,customAddress:e.target.value,address:null}),placeholder:"Street, city, building access info...",rows:3,value:bookingData.customAddress||""}),addresses.length>0&&(0,jsx_runtime.jsx)("button",{className:"text-[#64748b] text-sm hover:text-[#64748b]",onClick:()=>setUseCustomAddress(!1),type:"button",children:"â† Use saved address"})]})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"mb-2 block font-medium text-[#0f172a] text-sm",htmlFor:"special-instructions-enhanced",children:"Special Instructions"}),(0,jsx_runtime.jsx)("textarea",{className:"w-full rounded-md border border-[#e2e8f0] px-3 py-2 text-sm focus:border-[#64748b] focus:outline-none focus:ring-2 focus:ring-[#64748b]/20",id:"special-instructions-enhanced",onChange:e=>setBookingData({...bookingData,specialInstructions:e.target.value}),placeholder:"Pets, cleaning priorities, access codes...",rows:2,value:bookingData.specialInstructions})]}),addons.length>0&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"mb-2 block font-medium text-[#0f172a] text-sm",children:"Add Extra Services (Optional)"}),(0,jsx_runtime.jsx)("div",{className:"space-y-2",children:addons.map(addon=>{const isSelected=bookingData.selectedAddons.some(a=>a.id===addon.id);return(0,jsx_runtime.jsx)("button",{className:"w-full rounded-lg border p-3 text-left transition "+(isSelected?"border-[#64748b] bg-[#64748b]/5 ring-2 ring-[#64748b]/20":"border-[#e2e8f0] bg-[#f8fafc] hover:border-[#64748b]/50"),onClick:()=>(addon=>{const isSelected=bookingData.selectedAddons.some(a=>a.id===addon.id);setBookingData({...bookingData,selectedAddons:isSelected?bookingData.selectedAddons.filter(a=>a.id!==addon.id):[...bookingData.selectedAddons,addon]})})(addon),type:"button",children:(0,jsx_runtime.jsx)("div",{className:"flex items-start justify-between",children:(0,jsx_runtime.jsxs)("div",{className:"flex-1",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{className:"text-lg "+(isSelected?"opacity-100":"opacity-40"),children:isSelected?"âœ“":"â—‹"}),(0,jsx_runtime.jsx)("h4",{className:"font-semibold text-[#0f172a]",children:addon.name})]}),addon.description&&(0,jsx_runtime.jsx)("p",{className:"mt-1 text-[#94a3b8] text-sm",children:addon.description}),(0,jsx_runtime.jsxs)("div",{className:"mt-1 flex gap-3 text-[#94a3b8] text-xs",children:[(0,jsx_runtime.jsx)("span",{className:"font-semibold text-[#64748b]",children:formatCurrencyCOP(addon.price_cop)}),addon.duration_minutes>0&&(0,jsx_runtime.jsxs)("span",{children:["+",addon.duration_minutes," min"]})]})]})})},addon.id)})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between",children:[(0,jsx_runtime.jsx)("button",{className:"rounded-md border border-[#e2e8f0] px-6 py-2 font-semibold text-[#94a3b8] text-sm transition hover:border-[#64748b] hover:text-[#64748b]",onClick:onBack,type:"button",children:"â† Back"}),(0,jsx_runtime.jsx)("button",{className:"rounded-md bg-[#64748b] px-6 py-2 font-semibold text-sm text-[#f8fafc] transition hover:bg-[#64748b] disabled:cursor-not-allowed disabled:opacity-50",disabled:!canProceed,onClick:onNext,type:"button",children:"Review Booking â†’"})]})]})}function ConfirmationStep({bookingData,professionalName,baseAmount,addonsTotal,totalAmount,onBack,onConfirm,loading}){const showLivePriceBreakdown=(0,use_feature_flag.u)("live_price_breakdown"),selectedRate=bookingData.serviceHourlyRate??0;return(0,jsx_runtime.jsxs)("div",{className:"space-y-6",children:[(0,jsx_runtime.jsx)("h3",{className:"font-semibold text-[#0f172a] text-lg",children:"Review Your Booking"}),(0,jsx_runtime.jsxs)("div",{className:"space-y-4 rounded-lg border border-[#e2e8f0] bg-[#f8fafc] p-6",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h4",{className:"font-semibold text-[#94a3b8] text-sm",children:"Service"}),(0,jsx_runtime.jsxs)("p",{className:"mt-1 text-[#0f172a] text-sm",children:[bookingData.serviceName," with ",professionalName]})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h4",{className:"font-semibold text-[#94a3b8] text-sm",children:"Date & Time"}),(0,jsx_runtime.jsxs)("p",{className:"mt-1 text-[#0f172a] text-sm",children:[bookingData.selectedDate?.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})," ","at ",bookingData.selectedTime]}),(0,jsx_runtime.jsxs)("p",{className:"text-[#94a3b8] text-xs",children:["Duration: ",bookingData.durationHours," hours"]}),bookingData.isRecurring&&(0,jsx_runtime.jsxs)("p",{className:"mt-1 text-[#64748b] text-xs",children:["â±ï¸ Recurring ",bookingData.recurrencePattern?.frequency]})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h4",{className:"font-semibold text-[#94a3b8] text-sm",children:"Location"}),bookingData.address?(0,jsx_runtime.jsxs)("div",{className:"mt-1 text-[#0f172a] text-sm",children:[(0,jsx_runtime.jsx)("p",{children:bookingData.address.street}),(0,jsx_runtime.jsx)("p",{children:[bookingData.address.neighborhood,bookingData.address.city,bookingData.address.postal_code].filter(Boolean).join(", ")}),bookingData.address.building_access&&(0,jsx_runtime.jsxs)("p",{className:"text-[#94a3b8] text-xs",children:["ðŸ”‘ ",bookingData.address.building_access]})]}):(0,jsx_runtime.jsx)("p",{className:"mt-1 text-[#0f172a] text-sm",children:bookingData.customAddress})]}),bookingData.selectedAddons.length>0&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h4",{className:"font-semibold text-[#94a3b8] text-sm",children:"Add-ons"}),(0,jsx_runtime.jsx)("ul",{className:"mt-1 space-y-1",children:bookingData.selectedAddons.map(addon=>(0,jsx_runtime.jsxs)("li",{className:"flex justify-between text-[#0f172a] text-sm",children:[(0,jsx_runtime.jsx)("span",{children:addon.name}),(0,jsx_runtime.jsx)("span",{children:formatCurrencyCOP(addon.price_cop)})]},addon.id))})]}),bookingData.specialInstructions&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h4",{className:"font-semibold text-[#94a3b8] text-sm",children:"Special Instructions"}),(0,jsx_runtime.jsx)("p",{className:"mt-1 text-[#0f172a] text-sm",children:bookingData.specialInstructions})]}),showLivePriceBreakdown?(0,jsx_runtime.jsx)(price_breakdown.xY,{addonsTotal,baseAmount,hourlyRate:selectedRate,hours:bookingData.durationHours,showPlatformFee:!0}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"border-[#e2e8f0] border-t pt-4",children:(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,jsx_runtime.jsx)("span",{className:"text-[#94a3b8]",children:"Service"}),(0,jsx_runtime.jsx)("span",{className:"text-[#0f172a]",children:formatCurrencyCOP(baseAmount)})]}),addonsTotal>0&&(0,jsx_runtime.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,jsx_runtime.jsx)("span",{className:"text-[#94a3b8]",children:"Add-ons"}),(0,jsx_runtime.jsx)("span",{className:"text-[#0f172a]",children:formatCurrencyCOP(addonsTotal)})]}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between border-[#e2e8f0] border-t pt-2 font-semibold text-base",children:[(0,jsx_runtime.jsx)("span",{className:"text-[#0f172a]",children:"Total"}),(0,jsx_runtime.jsx)("span",{className:"text-[#64748b]",children:formatCurrencyCOP(totalAmount)})]})]})}),(0,jsx_runtime.jsx)("p",{className:"text-[#94a3b8] text-xs",children:"We'll place a temporary hold on your payment method. You'll only be charged after the service is completed."})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between",children:[(0,jsx_runtime.jsx)("button",{className:"rounded-md border border-[#e2e8f0] px-6 py-2 font-semibold text-[#94a3b8] text-sm transition hover:border-[#64748b] hover:text-[#64748b] disabled:cursor-not-allowed disabled:opacity-50",disabled:loading,onClick:onBack,type:"button",children:"â† Back"}),(0,jsx_runtime.jsx)("button",{className:"rounded-md bg-[#64748b] px-6 py-2 font-semibold text-sm text-[#f8fafc] transition hover:bg-[#64748b] disabled:cursor-not-allowed disabled:opacity-50",disabled:loading,onClick:onConfirm,type:"button",children:loading?"Creating booking...":"Proceed to Payment â†’"})]})]})}function PaymentConfirmation({bookingId,paymentIntentId,onReset}){const stripe=(0,react_stripe_esm.t2)(),elements=(0,react_stripe_esm.HH)(),router=(0,navigation.useRouter)(),[submitting,setSubmitting]=(0,react.useState)(!1),[error,setError]=(0,react.useState)(null);return(0,jsx_runtime.jsxs)("div",{className:"space-y-4 rounded-lg border border-[#e2e8f0] bg-[#f8fafc] p-6",children:[(0,jsx_runtime.jsx)("h3",{className:"font-semibold text-[#0f172a] text-lg",children:"Confirm Payment Method"}),(0,jsx_runtime.jsx)("p",{className:"text-[#94a3b8] text-sm",children:"We'll authorize a hold on your card. You'll only be charged after the service is completed."}),(0,jsx_runtime.jsx)(react_stripe_esm.He,{options:{layout:"tabs"}}),error&&(0,jsx_runtime.jsx)("p",{className:"text-[#64748b] text-sm",children:error}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-3",children:[(0,jsx_runtime.jsx)("button",{className:"rounded-md bg-[#64748b] px-6 py-2 font-semibold text-sm text-[#f8fafc] transition hover:bg-[#64748b] disabled:cursor-not-allowed disabled:opacity-50",disabled:submitting,onClick:async()=>{if(stripe&&elements){setSubmitting(!0),setError(null);try{const{error:paymentError,paymentIntent}=await stripe.confirmPayment({elements,confirmParams:{return_url:window.location.origin},redirect:"if_required"});if(paymentError)throw new Error(paymentError.message??"Payment requires additional verification.");"requires_capture"===paymentIntent?.status&&await fetch("/api/bookings/authorize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bookingId,paymentIntentId})}),router.push(`/bookings/${bookingId}`)}catch(err){setError(err instanceof Error?err.message:"Unexpected payment error")}finally{setSubmitting(!1)}}},type:"button",children:submitting?"Confirming...":"Confirm Booking"}),(0,jsx_runtime.jsx)("button",{className:"rounded-md border border-[#e2e8f0] px-6 py-2 font-semibold text-[#94a3b8] text-sm transition hover:border-[#64748b] hover:text-[#64748b] disabled:cursor-not-allowed disabled:opacity-50",disabled:submitting,onClick:onReset,type:"button",children:"Cancel"})]}),(0,jsx_runtime.jsxs)("p",{className:"text-[#94a3b8] text-xs",children:["Booking ID: ",bookingId]})]})}const stripeAppearance={theme:"flat",variables:{colorPrimary:"#64748b",colorText:"#0f172a",borderRadius:"8px"}};try{EnhancedBookingForm.displayName="EnhancedBookingForm",EnhancedBookingForm.__docgenInfo={description:"",displayName:"EnhancedBookingForm",props:{professionalId:{defaultValue:null,description:"",name:"professionalId",required:!0,type:{name:"string"}},professionalName:{defaultValue:null,description:"",name:"professionalName",required:!0,type:{name:"string"}},services:{defaultValue:null,description:"",name:"services",required:!0,type:{name:"ProfessionalService[]"}},defaultHourlyRate:{defaultValue:null,description:"",name:"defaultHourlyRate",required:!0,type:{name:"number"}},savedAddresses:{defaultValue:{value:"[]"},description:"",name:"savedAddresses",required:!1,type:{name:"SavedAddress[]"}},availableAddons:{defaultValue:{value:"[]"},description:"",name:"availableAddons",required:!1,type:{name:"ServiceAddon[]"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/bookings/enhanced-booking-form.tsx#EnhancedBookingForm"]={docgenInfo:EnhancedBookingForm.__docgenInfo,name:"EnhancedBookingForm",path:"src/components/bookings/enhanced-booking-form.tsx#EnhancedBookingForm"})}catch(__react_docgen_typescript_loader_error){}const enhanced_booking_form_stories={title:"Bookings/EnhancedBookingForm",component:EnhancedBookingForm,parameters:{layout:"padded"},tags:["autodocs"]},Default={},__namedExportsOrder=["Default"]},"./src/hooks/use-feature-flag.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{u:()=>useFeatureFlag});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),_lib_feature_flags__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/lib/feature-flags.ts");function useFeatureFlag(flag,userId){return(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>(0,_lib_feature_flags__WEBPACK_IMPORTED_MODULE_1__.G7)(flag,userId),[flag,userId])}},"./src/lib/feature-flags.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{G7:()=>isFeatureEnabled});var process=__webpack_require__("./node_modules/process/browser.js");const defaultFlags={show_match_wizard:!0,enable_web_vitals:!1,enhanced_trust_badges:!1,live_price_breakdown:!1,show_on_time_metrics:!1,auto_translate_chat:!0,one_tap_rebook:!0,recurring_plans:!0,rebook_nudge_system:!0,gps_check_in_out:!0,arrival_notifications:!0,time_extension_ui:!0,show_amara_assistant:!0,admin_verification_queue:!0,payout_ledger:!1,city_landing_pages:!0,show_platform_fee:!1,enable_tipping:!0,subscription_discount_badges:!1,caregiver_profiles:!1,maintenance_reminders:!1,referral_program:!0};function isFeatureEnabled(flag,userId){const envOverride=function getEnvOverride(flag){const envKey=`NEXT_PUBLIC_FEATURE_${flag.toUpperCase()}`,envValue=process.env[envKey];if(void 0!==envValue)return"true"===envValue||"1"===envValue}(flag);return void 0!==envOverride?envOverride:!(!userId||!function isBetaTester(userId,flag){const betaTesters={show_match_wizard:[],recurring_plans:[]};return betaTesters[flag]?.includes(userId)??!1}(userId,flag))||defaultFlags[flag]}},"./src/lib/supabase/browser-client.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{createSupabaseBrowserClient:()=>createSupabaseBrowserClient});var _supabase_ssr__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@supabase/ssr/dist/module/index.js");function createSupabaseBrowserClient(){const supabaseUrl="https://hvnetxfsrtplextvtwfx.supabase.co",supabaseKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh2bmV0eGZzcnRwbGV4dHZ0d2Z4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1ODc0NTEsImV4cCI6MjA3NzE2MzQ1MX0.7-N06om_ntUuGP1NZ0Zcqz01s975xJfiKno34aIW__o";return(0,_supabase_ssr__WEBPACK_IMPORTED_MODULE_0__.createBrowserClient)(supabaseUrl,supabaseKey)}},"./src/lib/utils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function cn(...classes){return classes.filter(Boolean).join(" ")}__webpack_require__.d(__webpack_exports__,{cn:()=>cn})}}]);